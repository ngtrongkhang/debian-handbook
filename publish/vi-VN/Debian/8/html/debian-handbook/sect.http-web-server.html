<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>11.2. Máy phục vụ Web (HTTP)</title><meta name="generator" content="publican v4.3.2"/><meta name="keywords" content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP"/><link rel="prev" href="network-services.html" title="Chương 11. Những dịch vụ mạng: Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN"/><link rel="next" href="sect.ftp-file-server.html" title="11.3. FTP File Server"/><link xmlns="" rel="canonical" href="https://debian-handbook.info/browse/vi-VN/stable/sect.http-web-server.html"/></head><body onLoad="initSwitchery(); jQuery(&quot;#poptoc&quot;).load('index.html .toc:eq(0)'); jQuery('.programlisting').each(function(i, block){hljs.highlightBlock(block);});" onClick="hide('poptoc');"><header><div id="banner"><a href="http://debian-handbook.info/get/"><span class="text">Download the ebook</span></a></div><ul class="docnav top"><li class="previous"><a accesskey="p" href="network-services.html"><strong>Trước đó</strong></a></li><li class="home" onClick="work=1;showhide('poptoc');">Sổ tay Quản trị Debian</li><li class="next"><a accesskey="n" href="sect.ftp-file-server.html"><strong>Kế tiếp</strong></a></li></ul></header><div id="poptoc" class="hidden"> </div><section class="section" id="sect.http-web-server"><div class="titlepage"><div><div><h2 class="title"><a xmlns="" id="sect.http-web-server"/>11.2. Máy phục vụ Web (HTTP)</h2></div></div></div>
		
		 <p>
			Những nhà quản trị của công ty Falcot quyết định sử dụng máy phục vụ HTTP Apache, có sẵn trong Debian <span class="distribution distribution">Jessie</span> tại phiên bản 2.4.10.
		</p>
		 <a id="id-1.14.5.3" class="indexterm"></a>
		 <a id="id-1.14.5.4" class="indexterm"></a>
		 <a id="id-1.14.5.5" class="indexterm"></a>
		 <a id="id-1.14.5.6" class="indexterm"></a>
		 <a id="id-1.14.5.7" class="indexterm"></a>
		 <div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong><span class="emphasis"><em>LỰA CHỌN THAY THẾ</em></span> Những máy phục vụ web khác</strong></p></div></div></div> 
		 <p>
			Apache chỉ là một máy phục vụ web được biết đến khá nhiều (và được sử dụng rộng rãi), nhưng có những nhà cung cấp khác; họ có thể cung cấp hiệu suất cao dưới một lượng tải nhất định nào đó, nhưng lựa chọn này bị cân bằng lại bởi ít tính năng và mô-đun hơn. Tuy nhiên, khi máy phục vụ web sẽ được lựa chọn để cung cấp các tập tin tĩnh hay để hoạt động như một trạm chuyển hướng, những lựa chọn khác, như là <span class="pkg pkg">nginx</span> và <span class="pkg pkg">lighttpd</span>, rất đáng để xem xét.
		</p>
		 <a id="id-1.14.5.8.3" class="indexterm"></a>
		 <a id="id-1.14.5.8.4" class="indexterm"></a>
		 </div> <section class="section" id="id-1.14.5.9"><div class="titlepage"><div><div><h3 class="title"><a xmlns="" id="id-1.14.5.9"/>11.2.1. Cài đặt Apache</h3></div></div></div>
			
			 <p>
				Cài đặt gói phần mềm <span class="pkg pkg">apache2</span> là tất cả những gì cần thiết. Nó chứa tất cả các mô-đun, bao gồm <span class="emphasis"><em>Những Mô-đun đa xử lý(Multi-Processing Modules)</em></span> (MPMs) kiểm soát việc Apache thực hiện việc xử lý song song những yêu cầu (những mô-đun trước đây được cung cấp dưới hình thức các gói phần mềm <span class="pkg pkg">apache2-mpm-*</span> rời rạc). Nó sẽ kéo về gói phần mềm <span class="pkg pkg">apache2-utils</span> vốn chứa những tiện ích dòng lệnh mà chúng ta sẽ khám phá sau.
			</p>
			 <p>
				MPM khi đang hoạt động ảnh hưởng lớn đến cách Apache xử lý các yêu cầu cùng lúc. Với MPM <span class="emphasis"><em>worker</em></span>, nó sử dụng các <span class="emphasis"><em>thread</em></span> (các tiến trình nhỏ và nhẹ), trong khi MPM <span class="emphasis"><em>prefork</em></span> sử dụng một kho tiến trình được tạo sẵn từ trước. Với MPM <span class="emphasis"><em>event</em></span>, nó cũng sử dụng các thread, nhưng các kết nối không có tín hiệu gì (đặc biệt những cái được giữ chạy bởi tính năng HTTP <span class="emphasis"><em>keep-alive</em></span>) được gửi lại cho một thread riêng quản lý.
			</p>
			 <p>
				Các nhà quản trị hệ thống Falcot cũng cài <span class="pkg pkg">libapache2-mod-php5</span> để đưa hỗ trợ PHP vào trong Apache. Điều này làm cho MPM <span class="emphasis"><em>event</em></span> ngầm định bị tắt đi, và <span class="emphasis"><em>prefork</em></span> được đưa vào sử dụng thay thế, bởi PHP chỉ hoạt động với MPM đó mà thôi.
			</p>
			 <div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong><span class="emphasis"><em>AN NINH</em></span> Thực thi dưới người dùng <code class="literal">www-data</code> </strong></p></div></div></div> 
			 <a id="id-1.14.5.9.5.2" class="indexterm"></a>
			 <a id="id-1.14.5.9.5.3" class="indexterm"></a>
			 <p>
				Theo ngầm định, Apache xử lý các yêu cầu đến dưới quyền người dùng của tài khoản <code class="literal">www-data</code>. Điều này nghĩa là một lỗ hổng bảo mật trong một đoạn mã kịch bản CGI thực thi bởi Apache (cho một trang web động) sẽ không làm lộ cả một hệ thống, nhưng chỉ nhưng tập tin được sở hữu bởi người sử dụng này.
			</p>
			 <p>
				Sử dụng các mô-đun <span class="emphasis"><em>suexec</em></span> cho phép vượt qua quy tắc này để một số đoạn mã CGI được thực thi dưới quyền người dùng của một tài khoản khác. Điều này được cấu hình bởi chỉ thị <code class="literal">SuexecUserGroup <em class="replaceable">user</em><em class="replaceable">group</em></code> trong cấu hình Apache.
			</p>
			 <a id="id-1.14.5.9.5.6" class="indexterm"></a>
			 <p>
				Một khả năng khác là sử dụng một MPM chuyên dụng, như là cái được cung cấp bởi <span class="pkg pkg">libapache2-mpm-itk</span>. Cái này có một hành vi hoàn toàn khác: nó cho phép “cách ly“ các máy ảo(virtual hosts) (thực ra, những tập hợp các trang) để mỗi cái trong số đó chạy dưới một người sử dụng khác nhau. Một lỗ hổng khác trong một trang web vì thế sẽ không thể làm lộ các tập tin thuộc về người sở hữu của trang web khác.
			</p>
			 </div> <div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong><span class="emphasis"><em>SƠ LƯỢC</em></span> Danh sách các mô-đun</strong></p></div></div></div> 
			 <p>
				Danh sách đầy đủ của các mô-đun chuẩn của Apache có thể tìm thấy trên mạng. <a class="ulink" href="http://httpd.apache.org/docs/2.4/mod/index.html">http://httpd.apache.org/docs/2.4/mod/index.html</a>
			</p>
			 </div> <p>
				Apache là một máy phục vụ cấu thành bởi nhiều mô-đun, và nhiều tính năng của nó được tạo ra bởi những mô-đun bên ngoài mà chương trình chính sẽ thực thi trong quá trình khởi động. Cấu hình ngầm định chỉ kích hoạt các mô-đun phổ biến nhất, nhưng để kích hoạt các mô-đun mới này chỉ cần đơn giản chạy lệnh <span class="command"><strong>a2enmod <em class="replaceable">module</em></strong></span>; để tắt một mô-đun, lệnh là <span class="command"><strong>a2dismod <em class="replaceable">module</em></strong></span>. Những chương trình này thực ra chỉ tạo (hoặc xóa) các đường link tượng trưng(symbolic links) trong <code class="filename">/etc/apache2/mods-enabled/</code>, vốn chỉ đến những tập tin thực sự (lưu trong <code class="filename">/etc/apache2/mods-available/</code>).
			</p>
			 <p>
				Với cấu hình ngầm định của nó, máy phục vụ web lắng nghe trên cổng 80 (như được cấu hình trong tập tin <code class="filename">/etc/apache2/ports.conf</code>), và phục vụ các trang nằm trong thư mục <code class="filename">/var/www/html/</code> (như được cấu hình trong tập tin <code class="filename">/etc/apache2/sites-enabled/000-default.conf</code>).
			</p>
			 <div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong><span class="emphasis"><em>TÌM HIỂU THÊM</em></span> Thêm hỗ trợ cho SSL</strong></p></div></div></div> 
			 <a id="id-1.14.5.9.9.2" class="indexterm"></a>
			 <a id="id-1.14.5.9.9.3" class="indexterm"></a>
			 <p>
				Apache 2.4 có sẵn một mô-đun SSL buộc phải có để hỗ trợ HTTP an toàn (HTTPS). Nó chỉ cần được kích hoạt với lệnh <span class="command"><strong>a2enmod ssl</strong></span>, sau đó các chỉ thị buộc phải có phải được thêm vào các tập tin cấu hình. Một ví dụ cấu hình được cung cấp trong <code class="filename">/etc/apache2/sites-available/default-ssl.conf</code>. <a class="ulink" href="http://httpd.apache.org/docs/2.4/mod/mod_ssl.html">http://httpd.apache.org/docs/2.4/mod/mod_ssl.html</a>
			</p>
			 <p>
				Phải cẩn thận hơn nếu bạn muốn ưu tiên các kết nối SSL với <span class="emphasis"><em>Bí mật Chiều đi Hoàn hảo(Perfect Forward Secrecy)</em></span> (những kết nối sử dụng các mã phiên làm việc tạm thời để đảm bảo rằng việc lộ mã bí mật của máy phục vụ không dẫn đến việc lộ thông tin cũ đã được mã hóa vốn có thể bị lưu lại trước đây khi có ai nghe lén trên đường truyền). Quan sát các đề xuất của Mozilla, cụ thể là ở <a class="ulink" href="https://wiki.mozilla.org/Security/Server_Side_TLS#Apache">https://wiki.mozilla.org/Security/Server_Side_TLS#Apache</a>
			</p>
			 <a id="id-1.14.5.9.9.6" class="indexterm"></a>
			 </div>
		</section>
		 <section class="section" id="id-1.14.5.10"><div class="titlepage"><div><div><h3 class="title"><a xmlns="" id="id-1.14.5.10"/>11.2.2. Cấu hình các máy ảo</h3></div></div></div>
			
			 <p>
				Một máy ảo là một danh xưng thêm cho một máy phục vụ.
			</p>
			 <a id="id-1.14.5.10.3" class="indexterm"></a>
			 <p>
				Apache có hai loại máy ảo khác nhau: một loại dựa trên địa chỉ IP (hoặc cổng), và một loại dựa trên tên miền của máy phục vụ web. Phương thức đầu tiên cần tạo một địa chỉ IP khác nhau (hay cổng) cho mỗi trang, trong khi phương thức số hai có thể hoạt động với một địa chỉ IP (và cổng) duy nhất, và những trang phân biệt bởi tên máy gửi bởi chương trình khách HTTP (vốn chỉ hoạt động tốt với phiên bản 1.1 của nghi thức HTTP - may mắn rằng phiên bản này đủ lâu để tất cả các chương trình khách đã sử dụng nó lâu rồi).
			</p>
			 <p>
				Sự khan hiếm ngày càng tăng của các địa chỉ IPv4 dẫn đến sự ưu tiên của phương thức số hai; tuy nhiên, nó được làm cho phức tạp hơn nếu các máy ảo cần cung cung cấp HTTPS, bởi vì giao thức SSL không luôn luôn cung cấp lưu trữ ảo dựa trên tên; phần mở rộng SNI (<span class="emphasis"><em>Tín hiệu chọn tên (Server Name Indication)</em></span>) vốn cho phép một sự kết hợp như vậy không được xử lý bởi tất cả trình duyệt. Khi vào trang HTTPS cần chạy trên cùng một máy phục vụ, chúng sẽ được phân biệt bằng việc chạy trên một cổng riêng biệt hoặc chạy trên một địa chỉ IP riêng biệt (IPv6 có thể giúp ích ở đây).
			</p>
			 <p>
				Cấu hình ngầm định của Apache 2 cho phép các máy ảo dựa trên tên. Hơn nữa, một máy phục vụ ngầm định được định nghĩa trong tập tin <code class="literal">/etc/apache2/sites-enabled/000-default.conf</code>; máy ảo này sẽ được sử dụng nếu không máy được tìm thấy nào hợp với yêu cầu gửi bởi khách.
			</p>
			 <div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong><span class="emphasis"><em>CẢNH BÁO</em></span> Máy ảo đầu tiên</strong></p></div></div></div> 
			 <p>
				Những yêu cầu liên quan tới những máy ảo sẽ luôn được phục vụ bởi máy ảo ngầm định đầu tiên. Đó là lý do chúng ta định nghĩa <code class="literal">www.falcot.com</code> đầu tiên ở đây.
			</p>
			 </div> <div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong><span class="emphasis"><em>SƠ LƯỢC</em></span> Apache hỗ trợ SNI</strong></p></div></div></div> 
			 <a id="id-1.14.5.10.8.2" class="indexterm"></a>
			 <p>
				Máy phục vụ Apache hỗ trợ một phần mở rộng của nghi thức SSL được gọi là <span class="emphasis"><em>Tín hiệu chọn tên(Server Name Indication)</em></span> (SNI). Phần mở rộng cho phép trình duyệt gửi tên máy của một máy phục vụ trong quá trình thiết lập kết nối SSL, sớm hơn nhiều so với chính yêu cầu HTTP, vốn được sử dụng trước đó để nhận dạng máy ảo được yêu cầu trong những máy được lưu trữ trên cùng một máy phục vụ (với cùng một địa chỉ IP và cổng). Điều này cho phép Apache chọn chứng chỉ SSL phù hợp nhất để tiếp tục giao dịch.
			</p>
			 <p>
				Trước SNI, Apache sẽ luôn sử dụng chứng chỉ được định nghĩa trong máy ảo ngầm định. Các máy khách cố gắng truy cập một máy ảo khác sẽ hiển thị các cảnh báo, bởi chứng chỉ chúng nhận được không hợp với trang web họ đang cố gắng truy cập. May mắn thay, đa số trình duyệt bây giờ làm việc với SNI; chúng bao gồm Microsoft Internet Explorer bắt đầu với phiên bản 7.0 (trên Vista), Mozilla Firefox bắt đầu với phiên bản 2.0, Apple Safari từ phiên bản 3.2.1, và tất cả các phiên bản của Google Chrome.
			</p>
			 <p>
				Gói phần mềm Apache cung cấp bởi Debian được xây dựng với hỗ trợ cho SNI; vì thế không cấu hình cụ thể nào là cần thiết.
			</p>
			 <p>
				Phải cẩn thận hơn trong việc đảm bảo rằng cấu hình cho máy ảo đầu tiên (cái được sử dụng ngầm định) kích hoạt TLSv1, bởi Apache dùng các tham số của máy ảo ngầm định đầu tiên để thiết lập các kết nối an toàn, và các kết nối này tốt hơn là nên cho phép chúng.
			</p>
			 </div> <p>
				Mỗi máy ảo thêm được mô tả bởi một tập tin được lưu trong <code class="filename">/etc/apache2/sites-available/</code>. Vì thế, cài đặt một trang web cho miền <code class="literal">falcot.org</code> đơn giản chỉ là tạo một tập tin sau, sau đó kích hoạt máy ảo với lệnh <span class="command"><strong>a2ensite www.falcot.org</strong></span>.
			</p>
			 <div class="example" id="id-1.14.5.10.10"><a xmlns="" id="id-1.14.5.10.10"/><p class="title"><strong>Ví dụ 11.16. Tập tin <code class="filename">/etc/apache2/sites-available/www.falcot.org.conf</code></strong></p><div class="example-contents">
				
				 
<pre class="programlisting">
&lt;VirtualHost *:80&gt;
ServerName www.falcot.org
ServerAlias falcot.org
DocumentRoot /srv/www/www.falcot.org
&lt;/VirtualHost&gt;</pre>

			</div></div>
			 <p>
				Máy phục vụ Apache, như được cấu hình như trước đây, sử dụng chung những tập tin nhật ký cho tất cả các máy ảo (mặc dù điều này có thể được thay đổi bằng việc thêm các chỉ thị <code class="literal">CustomLog</code> vào các định nghĩa của các máy ảo). Vì thế sẽ có lý khi tùy chỉnh định dạng của tập tin nhật ký này để nhờ nó đính kèm tên của máy ảo. Điều này có thể được thực hiện bằng việc tạo một <code class="filename">/etc/apache2/conf-available/customlog.conf</code> vốn định nghĩa một định dạng mới cho tất cả các tập tin nhật ký (với chỉ thị <code class="literal">LogFormat</code>) và bằng việc kích hoạt nó với lệnh <span class="command"><strong>a2enconf customlog</strong></span>. Dòng <code class="literal">CustomLog</code> phải được xóa bỏ (hay chuyển thành ghi chú) khỏi tập tin <code class="filename">/etc/apache2/sites-available/000-default.conf</code>.
			</p>
			 <div class="example" id="id-1.14.5.10.12"><a xmlns="" id="id-1.14.5.10.12"/><p class="title"><strong>Ví dụ 11.17. Tập tin <code class="filename">/etc/apache2/conf.d/customlog.conf</code></strong></p><div class="example-contents">
				
				 
<pre class="programlisting scale scale">
# Định dạng nhật ký mới bao gồm tên máy (ảo)
LogFormat "%v %h %l %u %t \"%r\" %&gt;s %b \"%{Referer}i\" \"%{User-Agent}i\"" vhost

# Bây giờ hãy sử dụng định dạng "vhost" cho lựa chọn ngầm định
CustomLog /var/log/apache2/access.log vhost</pre>

			</div></div>

		</section>
		 <section class="section" id="id-1.14.5.11"><div class="titlepage"><div><div><h3 class="title"><a xmlns="" id="id-1.14.5.11"/>11.2.3. Các chỉ thị phổ biến</h3></div></div></div>
			
			 <p>
				Phần này ôn lại một số chỉ thị của các chỉ thị cấu hình thường sử dụng của Apache.
			</p>
			 <a id="id-1.14.5.11.3" class="indexterm"></a>
			 <a id="id-1.14.5.11.4" class="indexterm"></a>
			 <p>
				Tập tin cấu hình chính thường bao gồm các khối <code class="literal">Directory</code>; chúng cho phép chỉ định những hành vi khác nhau cho một máy phục vụ tùy theo địa chỉ của tập tin sẽ được phục vụ. Một khối như vậy thường bao gồm các chỉ thị <code class="literal">Options</code> và các chỉ thị <code class="literal">AllowOverride</code>.
			</p>
			 <a id="id-1.14.5.11.6" class="indexterm"></a>
			 <a id="id-1.14.5.11.7" class="indexterm"></a>
			 <div class="example" id="id-1.14.5.11.8"><a xmlns="" id="id-1.14.5.11.8"/><p class="title"><strong>Ví dụ 11.18. Khối thư mục (Directory block)</strong></p><div class="example-contents">
				
				 
<pre class="programlisting">
&lt;Directory /var/www&gt;
Options Includes FollowSymlinks
AllowOverride All
DirectoryIndex index.php index.html index.htm
&lt;/Directory&gt;</pre>

			</div></div>
			 <p>
				Chỉ thị <code class="literal">DirectoryIndex</code> bao gồm một danh sách các tập tin để thử khi yêu cầu từ chương trình khách hợp với một thư mục. Tập tin đầu tiên tồn tại trong danh sách sẽ được sử dụng và gửi đi như là một câu trả lời.
			</p>
			 <a id="id-1.14.5.11.10" class="indexterm"></a>
			 <p>
				Chỉ thị <code class="literal">Options</code> được theo sau bởi một danh sách các lựa chọn để kích hoạt. Giá trị <code class="literal">None</code> tắt hết các lựa chọn; tương ứng, <code class="literal">All</code> kích hoạt tất cả ngoại trừ <code class="literal">MultiViews</code>. Các lựa chọn có sẵn bao gồm:
			</p>
			 <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					<p>
						<code class="literal">ExecCGI</code> báo rằng các mã kịch bản CGI có thể được thực thi. <a id="id-1.14.5.11.12.1.1.2" class="indexterm"></a>
					</p>

				</li><li class="listitem">
					<p>
						<code class="literal">FollowSymlinks</code> cho máy phục vụ biết là các đường link tượng trưng (symbolic links) có thể dùng để tìm ra địa điểm, và câu trả lời nên chứa những nội dung ở địa điểm của các đường link đó.<a id="id-1.14.5.11.12.2.1.2" class="indexterm"></a>
					</p>

				</li><li class="listitem">
					<p>
						<code class="literal">SymlinksIfOwnerMatch</code> cũng bảo máy phục vụ đi theo các đường dẫn tượng trưng (symbolic links), nhưng chỉ khi đường dẫn và đích của nó có chung một người sở hữu. <a id="id-1.14.5.11.12.3.1.2" class="indexterm"></a>
					</p>

				</li><li class="listitem">
					<p>
						<code class="literal">Includes</code> kích hoạt <span class="emphasis"><em>Các Hướng dẫn Kèm tập tin bên Máy phục vụ(Server Side Includes)</em></span>(ngắn gọn là <span class="emphasis"><em>SSI</em></span>). Những chỉ thị này được nhúng vào các trang HTML và thực thi theo yêu cầu. <a id="id-1.14.5.11.12.4.1.4" class="indexterm"></a>
					</p>

				</li><li class="listitem">
					<p>
						<code class="literal">Indexes</code> bảo máy phục vụ liệt kê nội dung của một thư mục nếu yêu cầu HTTP gửi bởi một chương trình khách chỉ đến một thư mục mà không có tập tin chỉ mục (index file) (nghĩa là khi không có tập tin nào được đề cập đến trong chỉ thị <code class="literal">DirectoryIndex</code> tồn tại trong thư mục này). <a id="id-1.14.5.11.12.5.1.3" class="indexterm"></a>
					</p>

				</li><li class="listitem">
					<p>
						<code class="literal">MultiViews</code> kích hoạt việc đàm phán về nội dung; điều này có thể được sử dụng bởi một máy phục vụ để trả về một trang web hợp với ngôn ngữ ưu tiên được cấu hình trong trình duyệt. <a id="id-1.14.5.11.12.6.1.2" class="indexterm"></a>
					</p>

				</li></ul></div>
			 <p>
			</p>
			 <div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong><span class="emphasis"><em>TRỞ VỀ CƠ BẢN</em></span> tập tin <code class="filename">.htaccess</code></strong></p></div></div></div> 
			 <p>
				Tập tin <code class="filename">.htaccess</code> chứa các chỉ thị cấu hình Apache được thực thi mỗi lần một yêu cầu cần đến một phần tử của một thư mục nơi nó được lưu. Phạm vi của những chỉ thị này sẽ đi sâu xuống các thư mục con bên trong nó.
			</p>
			 <a id="id-1.14.5.11.14.3" class="indexterm"></a>
			 <p>
				Đa số những chỉ thị có thể xảy ra trong khối <code class="literal">Directory</code> cũng hợp lệ trong tập tin <code class="filename">.htaccess</code>.
			</p>
			 </div> <p>
				Chỉ thị <code class="literal">AllowOverride</code> liệt kê tất cả những lựa chọn được kích hoạt hay được tắt bởi tập tin <code class="filename">.htaccess</code>. Một mục đích sử dụng của lựa chọn này là để giới hạn <code class="literal">ExecCGI</code>, để cho nhà quản trị hệ thống lựa chọn những người sử dụng nào được cho phép chạy các chương trình dưới danh xưng của máy phục vụ web (tài khoản <code class="literal">www-data</code>).
			</p>
			 <a id="id-1.14.5.11.16" class="indexterm"></a>
			 <section class="section" id="id-1.14.5.11.17"><div class="titlepage"><div><div><h4 class="title"><a xmlns="" id="id-1.14.5.11.17"/>11.2.3.1. Ràng buộc Chứng thực</h4></div></div></div>
				
				 <a id="id-1.14.5.11.17.2" class="indexterm"></a>
				 <p>
					Trong một số trường hợp, truy cập tới một phần của một trang web cần phải được giới hạn, để chỉ có những người sử dụng hợp lệ có tên tài khoản và mật mã mới được cho phép truy cập nội dung.
				</p>
				 <div class="example" id="id-1.14.5.11.17.4"><a xmlns="" id="id-1.14.5.11.17.4"/><p class="title"><strong>Ví dụ 11.19. Tập tin <code class="filename">.htaccess</code> bắt buộc chứng thực</strong></p><div class="example-contents">
					
					 
<pre class="programlisting">
Require valid-user
AuthName "Private directory"
AuthType Basic
AuthUserFile /etc/apache2/authfiles/htpasswd-private</pre>

				</div></div>
				 <div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong><span class="emphasis"><em>AN NINH</em></span> Không an toàn</strong></p></div></div></div> 
				 <p>
					Hệ thống chứng thực sử dụng trong ví dụ trên (<code class="literal">Basic</code>) có độ an toàn rất thấp bởi mật mã được gửi đi dưới dạng chữ (nó chỉ được mã hóa dưới dạng <span class="emphasis"><em>base64</em></span>, vốn là một dạng mã đơn giản hơn là một phương thức mã hóa). Cũng cần phải ghi chú rằng những tài liệu “được bảo vệ” bởi cơ chế này cũng di chuyển trên mạng không có ai trông coi. Nếu an ninh cần được coi trọng, toàn bộ kết nối HTTP nên được mã hóa với SSL.
				</p>
				 </div> <p>
					Tập tin <code class="filename">/etc/apache2/authfiles/htpasswd-private</code> chứa một danh sách các tên tài khoản và mật mã; nó thường được chỉnh sửa bởi lệnh <span class="command"><strong>htpasswd</strong></span>. Ví dụ, lệnh sau được sử dụng để thêm một tài khoản hoặc thay đổi mật mã: <a id="id-1.14.5.11.17.6.3" class="indexterm"></a>
				</p>
				 
<pre class="screen">
<code class="computeroutput"># </code><strong class="userinput"><code>htpasswd /etc/apache2/authfiles/htpasswd-private <em class="replaceable">user</em></code></strong><code class="computeroutput">Mật mã mới: Nhập lại mật mã mới: Thêm mật mã cho tài khoản <em class="replaceable">user</em></code></pre>

			</section>
			 <section class="section" id="id-1.14.5.11.18"><div class="titlepage"><div><div><h4 class="title"><a xmlns="" id="id-1.14.5.11.18"/>11.2.3.2. Giới hạn truy cập</h4></div></div></div>
				
				 <a id="id-1.14.5.11.18.2" class="indexterm"></a>
				 <p>
					Chỉ thị <code class="literal">Require</code> kiểm soát các giới hạn truy cập cho một thư mục (và những thư mục con, và tiếp tục như vậy cho chúng).
				</p>
				 <a id="id-1.14.5.11.18.4" class="indexterm"></a>
				 <a id="id-1.14.5.11.18.5" class="indexterm"></a>
				 <a id="id-1.14.5.11.18.6" class="indexterm"></a>
				 <p>
					Nó có thể được sử dụng để giới hạn truy cập dựa trên nhiều điều kiện; chúng ta sẽ ngưng tại việc mô tả giới hạn truy cập dựa trên địa chỉ IP của chương trình khách, nhưng nó có thể được làm cho mạnh hơn thế, đặc biệt khi vài chỉ thị <code class="literal">Require</code> được kết hợp trong một khối <code class="literal">RequireAll</code>.
				</p>
				 <div class="example" id="id-1.14.5.11.18.8"><a xmlns="" id="id-1.14.5.11.18.8"/><p class="title"><strong>Ví dụ 11.20. Chỉ cho phép từ mạng nội bộ</strong></p><div class="example-contents">
					
					 
<pre class="programlisting">Require ip 192.168.0.0/16</pre>

				</div></div>
				 <div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong><span class="emphasis"><em>LỰA CHỌN THAY THẾ</em></span> Cú pháp cũ</strong></p></div></div></div> 
				 <p>
					Cú pháp <code class="literal">Require</code> chỉ tồn tại trong Apache 2.4 (phiên bản có trong <span class="distribution distribution">Jessie</span>). Với những người sử dụng của <span class="distribution distribution">Wheezy</span>, cú pháp Apache 2.2 rất khác biệt, và chúng ta mô tả nó ở đây chủ yếu để tham khảo, mặc dù nó có thể được hỗ trợ trong Apache 2.4 bằng mô-đun <code class="literal">mod_access_compat</code>.
				</p>
				 <p>
					Các chỉ thị <code class="literal">Allow from</code> và <code class="literal">Deny from</code> kiểm soát các giới hạn truy cập cho một thư mục (và các thư mục con, và lại tiếp tục như vậy).
				</p>
				 <a id="id-1.14.5.11.18.9.4" class="indexterm"></a>
				 <a id="id-1.14.5.11.18.9.5" class="indexterm"></a>
				 <a id="id-1.14.5.11.18.9.6" class="indexterm"></a>
				 <p>
					Chỉ thị <code class="literal">Order</code> cho máy phục vụ biết rằng thứ tự thực thi các chỉ thị <code class="literal">Allow from</code> và <code class="literal">Deny from</code>; chỉ thị nằm cuối cùng và phải khớp được ưu tiên trước. Cụ thể hơn, <code class="literal">Order deny,allow</code> cho phép truy cập nếu không có <code class="literal">Deny from</code> nào áp dụng được, hoặc nếu một chỉ thị <code class="literal">Allow from</code> áp dụng được. Ngược lại, <code class="literal">Order allow,deny</code> từ chối truy cập nếu không có chỉ thị <code class="literal">Allow from</code> nào khớp (hoặc nếu một chỉ thị <code class="literal">Deny from</code> áp dụng được).
				</p>
				 <p>
					Các chỉ thị <code class="literal">Allow from</code> và <code class="literal">Deny from</code> có thể được theo sau bởi một địa chỉ IP, một dãy số cho vùng mạng (như là <code class="literal">192.168.0.0/255.255.255.0</code>, <code class="literal">192.168.0.0/24</code> or even <code class="literal">192.168.0</code>), một tên máy hoặc một tên miền, hoặc từ khóa <code class="literal">all</code>, ám chỉ bất cứ ai.
				</p>
				 <p>
					Ví dụ, để từ chối các kết nối theo ngầm định nhưng cho phép chúng từ mạng nội bộ, bạn có thể làm như sau:
				</p>
				 
<pre class="programlisting">
Order deny,allow
Allow from 192.168.0.0/16
Deny from all</pre>
				 </div>
			</section>

		</section>
		 <section class="section" id="id-1.14.5.12"><div class="titlepage"><div><div><h3 class="title"><a xmlns="" id="id-1.14.5.12"/>11.2.4. Các chương trình phân tích nhật ký</h3></div></div></div>
			
			 <p>
				Một chương trình phân tích nhật ký thường được cài đặt trên một máy phục vụ web; bởi chương trình phân tích cung cấp cho các quản trị viên một cái nhìn chính xác về quy luật hoạt động của máy phục vụ web.
			</p>
			 <p>
				Các nhà quản trị hệ thống Công ty Falcot đã lựa chọn <span class="emphasis"><em>AWStats</em></span> (<span class="emphasis"><em>Advanced Web Statistics (Thông số Web Chuyên sâu)</em></span>) để phân tích các tập tin nhật ký Apache.
			</p>
			 <a id="id-1.14.5.12.4" class="indexterm"></a>
			 <a id="id-1.14.5.12.5" class="indexterm"></a>
			 <a id="id-1.14.5.12.6" class="indexterm"></a>
			 <a id="id-1.14.5.12.7" class="indexterm"></a>
			 <p>
				Bước cấu hình đầu tiên là tùy chỉnh tập tin <code class="filename">/etc/awstats/awstats.conf</code>. Các nhà quản trị hê thống của Falcot giữ phần không thay đổi của nó khỏi các thông số sau đây:
			</p>
			 
<pre class="programlisting">
LogFile="/var/log/apache2/access.log"
LogFormat = "%virtualname %host %other %logname %time1 %methodurl %code %bytesd %refererquot %uaquot"
SiteDomain="www.falcot.com"
HostAliases="falcot.com REGEX[^.*\.falcot\.com$]"
DNSLookup=1
LoadPlugin="tooltips"</pre>
			 <p>
				Tất cả những thông số này đuợc ghi chú trong tập tin mẫu(template). Cụ thể hơn, các thông số <code class="varname">LogFile</code> và <code class="varname">LogFormat</code> mô tả địa điểm và định dạng của tập tin nhật ký và thông tin chứa đựng trong nó; <code class="varname">SiteDomain</code> và <code class="varname">HostAliases</code> liệt kê những cái tên mà trang web chính thức được biết tới.
			</p>
			 <p>
				Đối với những trang web có lưu lượng truyền tải cao, <code class="varname">DNSLookup</code> thuờng không nên được cài đặt giá trị <code class="literal">1</code>; cho những trang nhỏ, như cái Falcot được mô tả phía trên, cài đặt này cho phép thu thập nhiều bản báo cáo dễ đọc hơn vốn bao gồm những tên máy đầy đủ thay vì các địa chỉ IP thô.
			</p>
			 <div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong><span class="emphasis"><em>AN NINH</em></span> Truy cập tới các thông số</strong></p></div></div></div> 
			 <p>
				AWStats công bố các thông số của nó trên trang web mà không có giới hạn gì theo ngầm định, nhưng các giới hạn có thể được đặt ra để một số địa chỉ IP (có thể nội bộ) có thể truy cập chúng; danh sách các địa chỉ IP được cho phép cần phải được định nghĩa lại trong tham số <code class="varname">AllowAccessFromWebToFollowingIPAddresses</code>
			</p>
			 </div> <p>
				AWStats sẽ được kích hoạt cho các máy ảo(virtual host) khác;mỗi máy ảo cần có một tập tin cấu hình riêng, như là <code class="filename">/etc/awstats/awstats.www.falcot.org.conf</code>.
			</p>
			 <div class="example" id="id-1.14.5.12.14"><a xmlns="" id="id-1.14.5.12.14"/><p class="title"><strong>Ví dụ 11.21. Tập tin cấu hình AWStats cho một máy ảo(virtual host)</strong></p><div class="example-contents">
				
				 
<pre class="programlisting">
Include "/etc/awstats/awstats.conf"
SiteDomain="www.falcot.org"
HostAliases="falcot.org"</pre>

			</div></div>
			 <p>
				AWStats sử dụng nhiều biểu tượng lưu trong thư mục <code class="filename">/usr/share/awstats/icon/</code>. Để những biểu tượng này có thể được truy cập bởi trang web, cấu hình Apache cần được chỉnh sửa để bao gồm chỉ thị sau đây:
			</p>
			 
<pre class="programlisting">
Alias /awstats-icon/ /usr/share/awstats/icon/</pre>
			 <p>
				Sau một vài phút (và khi đoạn mã được chạy vài lần), các kết quả nằm sẵn trên mạng: <a class="ulink" href="http://www.falcot.com/cgi-bin/awstats.pl">http://www.falcot.com/cgi-bin/awstats.pl</a><a class="ulink" href="http://www.falcot.org/cgi-bin/awstats.pl">http://www.falcot.org/cgi-bin/awstats.pl</a>
			</p>
			 <div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong><span class="emphasis"><em>CẢNH BÁO</em></span> Quay vòng các tập tin nhật ký</strong></p></div></div></div> 
			 <p>
				Để những thông số này tính luôn cả các tập tin nhật ký, <span class="emphasis"><em>AWStats</em></span> cần được chạy ngay trước khi các tập tin nhật ký được xoay vòng. Xem chỉ thị <code class="literal">prerotate</code> của tập tin <code class="filename">/etc/logrotate.d/apache2</code>, điều này có thể được giải quyết bằng việc đặt một đường link tượng trưng vào <code class="filename">/usr/share/awstats/tools/update.sh</code> vào <code class="filename">/etc/logrotate.d/httpd-prerotate</code>:
			</p>
			 
<pre class="screen"><code class="computeroutput">$ </code><strong class="userinput"><code>cat /etc/logrotate.d/apache2 </code></strong><code class="computeroutput">/var/log/apache2/*.log { daily missingok rotate 14 compress delaycompress notifempty create 644 root adm sharedscripts postrotate if /etc/init.d/apache2 status &gt; /dev/null ; then \ /etc/init.d/apache2 reload &gt; /dev/null; \ fi; endscript prerotate if [ -d /etc/logrotate.d/httpd-prerotate ]; then \ run-parts /etc/logrotate.d/httpd-prerotate; \ fi; \ endscript } $ </code><strong class="userinput"><code>sudo mkdir -p /etc/logrotate.d/httpd-prerotate </code></strong><code class="computeroutput">$ </code><strong class="userinput"><code>sudo ln -sf /usr/share/awstats/tools/update.sh \ /etc/logrotate.d/httpd-prerotate/awstats </code></strong></pre>
			 <p>
				Ghi chú rằng các tập tin nhật ký tạo ra bởi lệnh <span class="command"><strong>logrotate</strong></span> cần có thể được đọc bởi mọi người, đặc biệt là AWStats. Trong ví dụ trên, điều này được đảm bảo bằng dòng <code class="literal">create 644 root adm</code> (thay vì mã truy cập <code class="literal">640</code> ngầm định).
			</p>
			 </div>
		</section>

	</section><footer/></body></html>