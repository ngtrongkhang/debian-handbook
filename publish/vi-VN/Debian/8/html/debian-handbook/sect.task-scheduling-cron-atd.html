<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>9.7. Scheduling Tasks with cron and atd</title><meta name="generator" content="publican v4.3.2"/><meta name="keywords" content="System boot, Initscripts, SSH, Telnet, Rights, Permissions, Supervision, Inetd, Cron, Backup, Hotplug, PCMCIA, APM, ACPI"/><link rel="prev" href="sect.inetd.html" title="9.6. The inetd Super-Server"/><link rel="next" href="sect.asynchronous-task-scheduling-anacron.html" title="9.8. Scheduling Asynchronous Tasks: anacron"/><link xmlns="" rel="canonical" href="https://debian-handbook.info/browse/vi-VN/stable/sect.task-scheduling-cron-atd.html"/></head><body onLoad="initSwitchery(); jQuery(&quot;#poptoc&quot;).load('index.html .toc:eq(0)'); jQuery('.programlisting').each(function(i, block){hljs.highlightBlock(block);});" onClick="hide('poptoc');"><header><div id="banner"><a href="http://debian-handbook.info/get/"><span class="text">Download the ebook</span></a></div><ul class="docnav top"><li class="previous"><a accesskey="p" href="sect.inetd.html"><strong>Trước đó</strong></a></li><li class="home" onClick="work=1;showhide('poptoc');">Sổ tay Quản trị Debian</li><li class="next"><a accesskey="n" href="sect.asynchronous-task-scheduling-anacron.html"><strong>Kế tiếp</strong></a></li></ul></header><div id="poptoc" class="hidden"> </div><section class="section" id="sect.task-scheduling-cron-atd"><div class="titlepage"><div><div><h2 class="title"><a xmlns="" id="sect.task-scheduling-cron-atd"/>9.7. Scheduling Tasks with <span class="command"><strong>cron</strong></span> and <span class="command"><strong>atd</strong></span></h2></div></div></div>
		
		 <a id="id-1.12.10.2" class="indexterm"></a>
		 <a id="id-1.12.10.3" class="indexterm"></a>
		 <a id="id-1.12.10.4" class="indexterm"></a>
		 <a id="id-1.12.10.5" class="indexterm"></a>
		 <p>
			<span class="command"><strong>cron</strong></span> is the daemon responsible for executing scheduled and recurring commands (every day, every week, etc.); <span class="command"><strong>atd</strong></span> is that which deals with commands to be executed a single time, but at a specific moment in the future.
		</p>
		 <p>
			In a Unix system, many tasks are scheduled for regular execution:
		</p>
		 <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
				<p>
					rotating the logs;
				</p>

			</li><li class="listitem">
				<p>
					updating the database for the <span class="command"><strong>locate</strong></span> program;
				</p>

			</li><li class="listitem">
				<p>
					back-ups;
				</p>

			</li><li class="listitem">
				<p>
					maintenance scripts (such as cleaning out temporary files).
				</p>

			</li></ul></div>
		 <p>
			By default, all users can schedule the execution of tasks. Each user has thus their own <span class="emphasis"><em>crontab</em></span> in which they can record scheduled commands. It can be edited by running <span class="command"><strong>crontab -e</strong></span> (its content is stored in the <code class="filename">/var/spool/cron/crontabs/<em class="replaceable">user</em></code> file).
		</p>
		 <div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong><span class="emphasis"><em>SECURITY</em></span> Restricting <span class="command"><strong>cron</strong></span> or <span class="command"><strong>atd</strong></span></strong></p></div></div></div> 
		 <p>
			You can restrict access to <span class="command"><strong>cron</strong></span> by creating an explicit authorization file (whitelist) in <code class="filename">/etc/cron.allow</code>, in which you indicate the only users authorized to schedule commands. All others will automatically be deprived of this feature. Conversely, to only block one or two troublemakers, you could write their username in the explicit prohibition file (blacklist), <code class="filename">/etc/cron.deny</code>. This same feature is available for <span class="command"><strong>atd</strong></span>, with the <code class="filename">/etc/at.allow</code> and <code class="filename">/etc/at.deny</code> files.
		</p>
		 </div> <p>
			The root user has their own <span class="emphasis"><em>crontab</em></span>, but can also use the <code class="filename">/etc/crontab</code> file, or write additional <span class="emphasis"><em>crontab</em></span> files in the <code class="filename">/etc/cron.d</code> directory. These last two solutions have the advantage of being able to specify the user identity to use when executing the command.
		</p>
		 <p>
			The <span class="emphasis"><em>cron</em></span> package includes by default some scheduled commands that execute:
		</p>
		 <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
				<p>
					programs in the <code class="filename">/etc/cron.hourly/</code> directory once per hour;
				</p>

			</li><li class="listitem">
				<p>
					programs in <code class="filename">/etc/cron.daily/</code> once per day;
				</p>

			</li><li class="listitem">
				<p>
					programs in <code class="filename">/etc/cron.weekly/</code> once per week;
				</p>

			</li><li class="listitem">
				<p>
					programs in <code class="filename">/etc/cron.monthly/</code> once per month.
				</p>

			</li></ul></div>
		 <p>
			Many Debian packages rely on this service: by putting maintenance scripts in these directories, they ensure optimal operation of their services.
		</p>
		 <section class="section" id="sect.format-crontab"><div class="titlepage"><div><div><h3 class="title"><a xmlns="" id="sect.format-crontab"/>9.7.1. Format of a <code class="filename">crontab</code> File</h3></div></div></div>
			
			 <a id="id-1.12.10.15.2" class="indexterm"></a>
			 <div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong><span class="emphasis"><em>TIP</em></span> Text shortcuts for <span class="command"><strong>cron</strong></span></strong></p></div></div></div> 
			 <p>
				<span class="command"><strong>cron</strong></span> recognizes some abbreviations which replace the first five fields in a <code class="filename">crontab</code> entry. They correspond to the most classic scheduling options:
			</p>
			 <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					<p>
						<code class="literal">@yearly</code>: once per year (January 1, at 00:00);
					</p>

				</li><li class="listitem">
					<p>
						<code class="literal">@monthly</code>: once per month (the 1st of the month, at 00:00);
					</p>

				</li><li class="listitem">
					<p>
						<code class="literal">@weekly</code>: once per week (Sunday at 00:00);
					</p>

				</li><li class="listitem">
					<p>
						<code class="literal">@daily</code>: once per day (at 00:00);
					</p>

				</li><li class="listitem">
					<p>
						<code class="literal">@hourly</code>: once per hour (at the beginning of each hour).
					</p>

				</li></ul></div>
			 </div> <div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong><span class="emphasis"><em>SPECIAL CASE</em></span> <span class="command"><strong>cron</strong></span> and daylight savings time</strong></p></div></div></div> 
			 <p>
				In Debian, <span class="command"><strong>cron</strong></span> takes the time change (for Daylight Savings Time, or in fact for any significant change in the local time) into account as best as it can. Thus, the commands that should have been executed during an hour that never existed (for example, tasks scheduled at 2:30 am during the Spring time change in France, since at 2:00 am the clock jumps directly to 3:00 am) are executed shortly after the time change (thus around 3:00 am DST). On the other hand, in autumn, when commands would be executed several times (2:30 am DST, then an hour later at 2:30 am standard time, since at 3:00 am DST the clock turns back to 2:00 am) are only executed once.
			</p>
			 <p>
				Be careful, however, if the order in which the different scheduled tasks and the delay between their respective executions matters, you should check the compatibility of these constraints with <span class="command"><strong>cron</strong></span>'s behavior; if necessary, you can prepare a special schedule for the two problematic nights per year.
			</p>
			 </div> <p>
				Each significant line of a <span class="emphasis"><em>crontab</em></span> describes a scheduled command with the six (or seven) following fields:
			</p>
			 <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					<p>
						the value for the minute (number from 0 to 59);
					</p>

				</li><li class="listitem">
					<p>
						the value for the hour (from 0 to 23);
					</p>

				</li><li class="listitem">
					<p>
						the value for the day of the month (from 1 to 31);
					</p>

				</li><li class="listitem">
					<p>
						the value for the month (from 1 to 12);
					</p>

				</li><li class="listitem">
					<p>
						the value for the day of the week (from 0 to 7, 1 corresponding to Monday, Sunday being represented by both 0 and 7; it is also possible to use the first three letters of the name of the day of the week in English, such as <code class="literal">Sun</code>, <code class="literal">Mon</code>, etc.);
					</p>

				</li><li class="listitem">
					<p>
						the user name under whose identity the command must be executed (in the <code class="filename">/etc/crontab</code> file and in the fragments located in <code class="filename">/etc/cron.d/</code>, but not in the users' own crontab files);
					</p>

				</li><li class="listitem">
					<p>
						the command to execute (when the conditions defined by the first five columns are met).
					</p>

				</li></ul></div>
			 <p>
				All these details are documented in the <span class="citerefentry"><span class="refentrytitle">crontab</span>
				 (5)</span> man page.
			</p>
			 <p>
				Each value can be expressed in the form of a list of possible values (separated by commas). The syntax <code class="literal">a-b</code> describes the interval of all the values between <code class="literal">a</code> and <code class="literal">b</code>. The syntax <code class="literal">a-b/c</code> describes the interval with an increment of <code class="literal">c</code> (example: <code class="literal">0-10/2</code> means <code class="literal">0,2,4,6,8,10</code>). An asterisk <code class="literal">*</code> is a wildcard, representing all possible values.
			</p>
			 <div class="example" id="example.crontab"><a xmlns="" id="example.crontab"/><p class="title"><strong>Ví dụ 9.2. Sample <code class="filename">crontab</code> file</strong></p><div class="example-contents">
				
				 
<pre class="programlisting">#Format
#min hour day mon dow  command

# Download data every night at 7:25 pm
 25  19   *   *   *    $HOME/bin/get.pl

# 8:00 am, on weekdays (Monday through Friday)
 00  08   *   *   1-5  $HOME/bin/dosomething

# Restart the IRC proxy after each reboot
@reboot /usr/bin/dircproxy
</pre>

			</div></div>
			 <div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong><span class="emphasis"><em>TIP</em></span> Executing a command on boot</strong></p></div></div></div> 
			 <p>
				To execute a command a single time, just after booting the computer, you can use the <code class="literal">@reboot</code> macro (a simple restart of <span class="command"><strong>cron</strong></span> does not trigger a command scheduled with <code class="literal">@reboot</code>). This macro replaces the first five fields of an entry in the <span class="emphasis"><em>crontab</em></span>.
			</p>
			 </div> <div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong><span class="emphasis"><em>ALTERNATIVE</em></span> Emulating <span class="command"><strong>cron</strong></span> with <span class="command"><strong>systemd</strong></span></strong></p></div></div></div> 
			 <p>
				It is possible to emulate part of <span class="command"><strong>cron</strong></span>'s behaviour with <span class="command"><strong>systemd</strong></span>'s timer mechanism (see <a class="xref" href="unix-services.html#sect.systemd" title="9.1.1. The systemd init system">Phần 9.1.1, “The systemd init system”</a>).
			</p>
			 </div>
		</section>
		 <section class="section" id="sect.at-command"><div class="titlepage"><div><div><h3 class="title"><a xmlns="" id="sect.at-command"/>9.7.2. Using the <span class="command"><strong>at</strong></span> Command</h3></div></div></div>
			
			 <a id="id-1.12.10.16.2" class="indexterm"></a>
			 <p>
				The <span class="command"><strong>at</strong></span> executes a command at a specified moment in the future. It takes the desired time and date as command-line parameters, and the command to be executed in its standard input. The command will be executed as if it had been entered in the current shell. <span class="command"><strong>at</strong></span> even takes care to retain the current environment, in order to reproduce the same conditions when it executes the command. The time is indicated by following the usual conventions: <code class="literal">16:12</code> or <code class="literal">4:12pm</code> represents 4:12 pm. The date can be specified in several European and Western formats, including <code class="literal">DD.MM.YY</code> (<code class="literal">27.07.15</code> thus representing 27 July 2015), <code class="literal">YYYY-MM-DD</code> (this same date being expressed as <code class="literal">2015-07-27</code>), <code class="literal">MM/DD/[CC]YY</code> (ie., <code class="literal">12/25/15</code> or <code class="literal">12/25/2015</code> will be December 25, 2015), or simple <code class="literal">MMDD[CC]YY</code> (so that <code class="literal">122515</code> or <code class="literal">12252015</code> will, likewise, represent December 25, 2015). Without it, the command will be executed as soon as the clock reaches the time indicated (the same day, or tomorrow if that time has already passed on the same day). You can also simply write “today” or “tomorrow”, which is self-explanatory.
			</p>
			 
<pre class="screen">
<code class="computeroutput">$ </code><strong class="userinput"><code>at 09:00 27.07.15 &lt;&lt;END</code></strong>
<code class="computeroutput">&gt; </code><strong class="userinput"><code>echo "Don't forget to wish a Happy Birthday to Raphaël!" \</code></strong>
<code class="computeroutput">&gt; </code><strong class="userinput"><code> | mail lolando@debian.org</code></strong>
<code class="computeroutput">&gt; </code><strong class="userinput"><code>END</code></strong>
<code class="computeroutput">warning: commands will be executed using /bin/sh job 31 at Mon Jul 27 09:00:00 2015</code></pre>
			 <p>
				An alternative syntax postpones the execution for a given duration: <span class="command"><strong>at now + <em class="replaceable">number</em> <em class="replaceable">period</em></strong></span>. The <em class="replaceable">period</em> can be <code class="literal">minutes</code>, <code class="literal">hours</code>, <code class="literal">days</code>, or <code class="literal">weeks</code>. The <em class="replaceable">number</em> simply indicates the number of said units that must elapse before execution of the command.
			</p>
			 <p>
				To cancel a task scheduled by <span class="command"><strong>cron</strong></span>, simply run <span class="command"><strong>crontab -e</strong></span> and delete the corresponding line in the <span class="emphasis"><em>crontab</em></span> file. For <span class="command"><strong>at</strong></span> tasks, it is almost as easy: run <span class="command"><strong>atrm <em class="replaceable">task-number</em></strong></span>. The task number is indicated by the <span class="command"><strong>at</strong></span> command when you scheduled it, but you can find it again with the <span class="command"><strong>atq</strong></span> command, which gives the current list of scheduled tasks.
			</p>
			 <a id="id-1.12.10.16.7" class="indexterm"></a>
			 <a id="id-1.12.10.16.8" class="indexterm"></a>

		</section>

	</section><footer/></body></html>