<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>11.5. Setting Up Windows Shares with Samba</title><meta name="generator" content="publican v4.3.2"/><meta name="keywords" content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP"/><link rel="prev" href="sect.nfs-file-server.html" title="11.4. Máy phục vụ tập tin NFS"/><link rel="next" href="sect.http-ftp-proxy.html" title="11.6. HTTP/FTP Proxy"/><link xmlns="" rel="canonical" href="https://debian-handbook.info/browse/vi-VN/stable/sect.windows-file-server-with-samba.html"/></head><body onLoad="initSwitchery(); jQuery(&quot;#poptoc&quot;).load('index.html .toc:eq(0)'); jQuery('.programlisting').each(function(i, block){hljs.highlightBlock(block);});" onClick="hide('poptoc');"><header><div id="banner"><a href="http://debian-handbook.info/get/"><span class="text">Download the ebook</span></a></div><ul class="docnav top"><li class="previous"><a accesskey="p" href="sect.nfs-file-server.html"><strong>Trước đó</strong></a></li><li class="home" onClick="work=1;showhide('poptoc');">Sổ tay Quản trị Debian</li><li class="next"><a accesskey="n" href="sect.http-ftp-proxy.html"><strong>Kế tiếp</strong></a></li></ul></header><div id="poptoc" class="hidden"> </div><section class="section" id="sect.windows-file-server-with-samba"><div class="titlepage"><div><div><h2 class="title"><a xmlns="" id="sect.windows-file-server-with-samba"/>11.5. Setting Up Windows Shares with Samba</h2></div></div></div>
		
		 <p>
			Samba is a suite of tools handling the SMB protocol (also known as “CIFS”) on Linux. This protocol is used by Windows for network shares and shared printers.
		</p>
		 <a id="id-1.14.8.3" class="indexterm"></a>
		 <a id="id-1.14.8.4" class="indexterm"></a>
		 <a id="id-1.14.8.5" class="indexterm"></a>
		 <a id="id-1.14.8.6" class="indexterm"></a>
		 <a id="id-1.14.8.7" class="indexterm"></a>
		 <p>
			Samba can also act as an Windows domain controller. This is an outstanding tool for ensuring seamless integration of Linux servers and the office desktop machines still running Windows.
		</p>
		 <section class="section" id="id-1.14.8.9"><div class="titlepage"><div><div><h3 class="title"><a xmlns="" id="id-1.14.8.9"/>11.5.1. Samba Server</h3></div></div></div>
			
			 <p>
				The <span class="pkg pkg">samba</span> package contains the main two servers of Samba 4, <span class="command"><strong>smbd</strong></span> and <span class="command"><strong>nmbd</strong></span>.
			</p>
			 <a id="id-1.14.8.9.3" class="indexterm"></a>
			 <a id="id-1.14.8.9.4" class="indexterm"></a>
			 <div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong><span class="emphasis"><em>DOCUMENTATION</em></span> Going further</strong></p></div></div></div> 
			 <p>
				The Samba server is extremely configurable and versatile, and can address a great many different use cases matching very different requirements and network architectures. This book only focuses on the use case where Samba is used as a standalone server, but it can also be a NT4 Domain Controller or a full Active Directory Domain Controller, or a simple member of an existing domain (which could be a managed by a Windows server).
			</p>
			 <a id="id-1.14.8.9.5.3" class="indexterm"></a>
			 <a id="id-1.14.8.9.5.4" class="indexterm"></a>
			 <p>
				The <span class="pkg pkg">samba-doc</span> package contains a wealth of commented example files in <code class="filename">/usr/share/doc/samba-doc/examples/</code>.
			</p>
			 </div> <div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong><span class="emphasis"><em>TOOL</em></span> Authenticating with a Windows Server</strong></p></div></div></div> 
			 <p>
				Winbind gives system administrators the option of using a Windows server as an authentication server. Winbind also integrates cleanly with PAM and NSS. This allows setting up Linux machines where all users of a Windows domain automatically get an account.
			</p>
			 <a id="id-1.14.8.9.6.3" class="indexterm"></a>
			 <p>
				More information can be found in the <code class="filename">/usr/share/doc/samba-doc/examples/pam_winbind/</code> directory.
			</p>
			 </div> <section class="section" id="id-1.14.8.9.7"><div class="titlepage"><div><div><h4 class="title"><a xmlns="" id="id-1.14.8.9.7"/>11.5.1.1. Configuring with <span class="command"><strong>debconf</strong></span></h4></div></div></div>
				
				 <p>
					The package sets up a minimal configuration during the initial installation but you should really run <span class="command"><strong>dpkg-reconfigure samba-common</strong></span> to adapt it:
				</p>
				 <p>
					The first piece of required information is the name of the workgroup where the Samba server will belong (the answer is <code class="literal">FALCOTNET</code> in our case).
				</p>
				 <p>
					The package also proposes identifying the WINS server from the information provided by the DHCP daemon. The Falcot Corp administrators rejected this option, since they intend to use the Samba server itself as the WINS server.
				</p>
				 <a id="id-1.14.8.9.7.5" class="indexterm"></a>

			</section>
			 <section class="section" id="id-1.14.8.9.8"><div class="titlepage"><div><div><h4 class="title"><a xmlns="" id="id-1.14.8.9.8"/>11.5.1.2. Configuring Manually</h4></div></div></div>
				
				 <section class="section" id="id-1.14.8.9.8.2"><div class="titlepage"><div><div><h5 class="title"><a xmlns="" id="id-1.14.8.9.8.2"/>11.5.1.2.1. Changes to <code class="filename">smb.conf</code></h5></div></div></div>
					
					 <p>
						The requirements at Falcot require other options to be modified in the <code class="filename">/etc/samba/smb.conf</code> configuration file. The following excerpts summarize the changes that were effected in the <code class="literal">[global]</code> section.
					</p>
					 
<pre class="programlisting">
[global]

## Browsing/Identification ###

# Change this to the workgroup/NT-domain name your Samba server will part of
   workgroup = FALCOTNET

# Windows Internet Name Serving Support Section:
# WINS Support - Tells the NMBD component of Samba to enable its WINS Server
   wins support = yes <span id="smb.conf.wins"/><a xmlns="" id="smb.conf.wins"/><span class="callout">1</span>

[...]

####### Authentication #######

# Server role. Defines in which mode Samba will operate. Possible
# values are "standalone server", "member server", "classic primary
# domain controller", "classic backup domain controller", "active
# directory domain controller". 
#
# Most people will want "standalone sever" or "member server".
# Running as "active directory domain controller" will require first
# running "samba-tool domain provision" to wipe databases and create a
# new domain.
   server role = standalone server

# "security = user" is always a good idea. This will require a Unix account
# in this server for every user accessing the server.
   security = user <span id="smb.conf.security"/><a xmlns="" id="smb.conf.security"/><span class="callout">2</span>

[...]
</pre>
					 <div class="calloutlist"><dl class="calloutlist"><dt><a href="#smb.conf.wins"><span class="callout">1</span></a> </dt><dd>
							<p>
								Indicates that Samba should act as a Netbios name server (WINS) for the local network.
							</p>

						</dd><dt><a href="#smb.conf.security"><span class="callout">2</span></a> </dt><dd>
							<p>
								This is the default value for this parameter; however, since it is central to the Samba configuration, filling it explicitly is recommended. Each user must authenticate before accessing any share.
							</p>

						</dd></dl></div>

				</section>
				 <section class="section" id="id-1.14.8.9.8.3"><div class="titlepage"><div><div><h5 class="title"><a xmlns="" id="id-1.14.8.9.8.3"/>11.5.1.2.2. Adding Users</h5></div></div></div>
					
					 <p>
						Each Samba user needs an account on the server; the Unix accounts must be created first, then the user needs to be registered in Samba's database. The Unix step is done quite normally (using <span class="command"><strong>adduser</strong></span> for instance).
					</p>
					 <p>
						Adding an existing user to the Samba database is a matter of running the <span class="command"><strong>smbpasswd -a <em class="replaceable">user</em></strong></span> command; this command asks for the password interactively.
					</p>
					 <p>
						A user can be deleted with the <span class="command"><strong>smbpasswd -x <em class="replaceable">user</em></strong></span> command. A Samba account can also be temporarily disabled (with <span class="command"><strong>smbpasswd -d <em class="replaceable">user</em></strong></span>) and re-enabled later (with <span class="command"><strong>smbpasswd -e <em class="replaceable">user</em></strong></span>).
					</p>

				</section>

			</section>

		</section>
		 <section class="section" id="id-1.14.8.10"><div class="titlepage"><div><div><h3 class="title"><a xmlns="" id="id-1.14.8.10"/>11.5.2. Samba Client</h3></div></div></div>
			
			 <p>
				The client features in Samba allow a Linux machine to access Windows shares and shared printers. The required programs are available in the <span class="pkg pkg">cifs-utils</span> and <span class="pkg pkg">smbclient</span> packages.
			</p>
			 <a id="id-1.14.8.10.3" class="indexterm"></a>
			 <a id="id-1.14.8.10.4" class="indexterm"></a>
			 <section class="section" id="id-1.14.8.10.5"><div class="titlepage"><div><div><h4 class="title"><a xmlns="" id="id-1.14.8.10.5"/>11.5.2.1. The <span class="command"><strong>smbclient</strong></span> Program</h4></div></div></div>
				
				 <p>
					The <span class="command"><strong>smbclient</strong></span> program queries SMB servers. It accepts a <code class="literal">-U <em class="replaceable">user</em></code> option, for connecting to the server under a specific identity. <span class="command"><strong>smbclient //<em class="replaceable">server</em>/<em class="replaceable">share</em></strong></span> accesses the share in an interactive way similar to the command-line FTP client. <span class="command"><strong>smbclient -L <em class="replaceable">server</em></strong></span> lists all available (and visible) shares on a server.
				</p>

			</section>
			 <section class="section" id="id-1.14.8.10.6"><div class="titlepage"><div><div><h4 class="title"><a xmlns="" id="id-1.14.8.10.6"/>11.5.2.2. Mounting Windows Shares</h4></div></div></div>
				
				 <p>
					The <span class="command"><strong>mount</strong></span> command allows mounting a Windows share into the Linux filesystem hierarchy (with the help of <span class="command"><strong>mount.cifs</strong></span> provided by <span class="pkg pkg">cifs-utils</span>).
				</p>
				 <a id="id-1.14.8.10.6.3" class="indexterm"></a>
				 <a id="id-1.14.8.10.6.4" class="indexterm"></a>
				 <div class="example" id="id-1.14.8.10.6.5"><a xmlns="" id="id-1.14.8.10.6.5"/><p class="title"><strong>Ví dụ 11.24. Mounting a Windows share</strong></p><div class="example-contents">
					
					 
<pre class="programlisting">
mount -t cifs //arrakis/shared /shared \
      -o credentials=/etc/smb-credentials
</pre>

				</div></div>
				 <p>
					The <code class="filename">/etc/smb-credentials</code> file (which must not be readable by users) has the following format:
				</p>
				 
<pre class="programlisting">
username = <em class="replaceable">user</em>
password = <em class="replaceable">password</em></pre>
				 <p>
					Other options can be specified on the command-line; their full list is available in the <span class="citerefentry"><span class="refentrytitle">mount.cifs</span>
					 (1)</span> manual page. Two options in particular can be interesting: <code class="literal">uid</code> and <code class="literal">gid</code> allow forcing the owner and group of files available on the mount, so as not to restrict access to root.
				</p>
				 <p>
					A mount of a Windows share can also be configured in <code class="filename">/etc/fstab</code>:
				</p>
				 
<pre class="programlisting">
//<em class="replaceable">server</em>/shared /shared cifs credentials=/etc/smb-credentials
</pre>
				 <p>
					Unmounting a SMB/CIFS share is done with the standard <span class="command"><strong>umount</strong></span> command.
				</p>

			</section>
			 <section class="section" id="id-1.14.8.10.7"><div class="titlepage"><div><div><h4 class="title"><a xmlns="" id="id-1.14.8.10.7"/>11.5.2.3. Printing on a Shared Printer</h4></div></div></div>
				
				 <p>
					CUPS is an elegant solution for printing from a Linux workstation to a printer shared by a Windows machine. When the <span class="pkg pkg">smbclient</span> is installed, CUPS allows installing Windows shared printers automatically.
				</p>
				 <a id="id-1.14.8.10.7.3" class="indexterm"></a>
				 <p>
					Here are the required steps:
				</p>
				 <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<p>
							Enter the CUPS configuration interface: <code class="literal">http://localhost:631/admin</code>
						</p>

					</li><li class="listitem">
						<p>
							Click on “Add Printer”.
						</p>

					</li><li class="listitem">
						<p>
							Choose the printer device, pick “Windows Printer via SAMBA”.
						</p>

					</li><li class="listitem">
						<p>
							Enter the connection URI for the network printer. It should look like the following:
						</p>
						 <p>
							<code class="literal">smb://<em class="replaceable">user</em>:<em class="replaceable">password</em>@<em class="replaceable">server</em>/<em class="replaceable">printer</em></code>.
						</p>

					</li><li class="listitem">
						<p>
							Enter the name that will uniquely identify this printer. Then enter the description and location of the printer. Those are the strings that will be shown to end users to help them identify the printers.
						</p>

					</li><li class="listitem">
						<p>
							Indicate the manufacturer/model of the printer, or directly provide a working printer description file (PPD).
						</p>

					</li></ul></div>
				 <p>
					Voilà, the printer is operational!
				</p>

			</section>

		</section>

	</section><footer/></body></html>