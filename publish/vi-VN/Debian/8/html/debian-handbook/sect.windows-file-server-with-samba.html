<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>11.5. Cài đặt các chia sẻ Windows với Samba</title><meta name="generator" content="publican v4.3.2"/><meta name="keywords" content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP"/><link rel="prev" href="sect.nfs-file-server.html" title="11.4. Máy phục vụ tập tin NFS"/><link rel="next" href="sect.http-ftp-proxy.html" title="11.6. HTTP/FTP Proxy"/><link xmlns="" rel="canonical" href="https://debian-handbook.info/browse/vi-VN/stable/sect.windows-file-server-with-samba.html"/></head><body onLoad="initSwitchery(); jQuery(&quot;#poptoc&quot;).load('index.html .toc:eq(0)'); jQuery('.programlisting').each(function(i, block){hljs.highlightBlock(block);});" onClick="hide('poptoc');"><header><div id="banner"><a href="http://debian-handbook.info/get/"><span class="text">Download the ebook</span></a></div><ul class="docnav top"><li class="previous"><a accesskey="p" href="sect.nfs-file-server.html"><strong>Trước đó</strong></a></li><li class="home" onClick="work=1;showhide('poptoc');">Sổ tay Quản trị Debian</li><li class="next"><a accesskey="n" href="sect.http-ftp-proxy.html"><strong>Kế tiếp</strong></a></li></ul></header><div id="poptoc" class="hidden"> </div><section class="section" id="sect.windows-file-server-with-samba"><div class="titlepage"><div><div><h2 class="title"><a xmlns="" id="sect.windows-file-server-with-samba"/>11.5. Cài đặt các chia sẻ Windows với Samba</h2></div></div></div>
		
		 <p>
			Samba là một tập hợp các công cụ làm việc với giao thức SMB (cũng được biết đến như là “CIFS”) trên Linux. Giao thức này được sử dụng bởi Windows cho các chia sẻ qua mạng và chia sẻ máy in.
		</p>
		 <a id="id-1.14.8.3" class="indexterm"></a>
		 <a id="id-1.14.8.4" class="indexterm"></a>
		 <a id="id-1.14.8.5" class="indexterm"></a>
		 <a id="id-1.14.8.6" class="indexterm"></a>
		 <a id="id-1.14.8.7" class="indexterm"></a>
		 <p>
			Samba cũng có thể hoạt động như một trạm điều khiển miền máy tính (domain controller) của Windows. Nó là một công cụ tuyệt vời để đảm bảo tích hợp xuyên suốt với các máy phục vụ Linux và các máy tính bàn trong văn phòng vốn vẫn sử dụng Windows.
		</p>
		 <section class="section" id="id-1.14.8.9"><div class="titlepage"><div><div><h3 class="title"><a xmlns="" id="id-1.14.8.9"/>11.5.1. Máy phục vụ Samba</h3></div></div></div>
			
			 <p>
				Gói phần mềm <span class="pkg pkg">samba</span> chứa hai máy phục vụ của Samba 4, <span class="command"><strong>smbd</strong></span> and <span class="command"><strong>nmbd</strong></span>.
			</p>
			 <a id="id-1.14.8.9.3" class="indexterm"></a>
			 <a id="id-1.14.8.9.4" class="indexterm"></a>
			 <div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong><span class="emphasis"><em>TÀI LIỆU HƯỚNG DẪN</em></span> Đi sâu hơn</strong></p></div></div></div> 
			 <p>
				Máy phục vụ Samba rất dễ cấu hình và đa dụng, và có thể hoạt động trong nhiều trường hợp với các yêu cầu và hạ tầng mạng ít có điểm chung. Cuốn sách này chỉ tập trung vào trường hợp Samba được sử dụng như một máy phục vụ đứng một mình, nhưng nó cũng có thể là một trạm điều khiển máy tính NT4(NT4 Domain Controller) hoặc một trạm điều khiển Active Directory(Active Directory Domain Controller), hoặc một thành viên đơn giản của một miền máy tính đã có (vốn có thể là một máy phục vụ Windows).
			</p>
			 <a id="id-1.14.8.9.5.3" class="indexterm"></a>
			 <a id="id-1.14.8.9.5.4" class="indexterm"></a>
			 <p>
				Gói phần mềm <span class="pkg pkg">samba-doc</span> chứa rất nhiều tập tin ví dụ được ghi chú trong <code class="filename">/usr/share/doc/samba-doc/examples/</code>.
			</p>
			 </div> <div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong><span class="emphasis"><em>CÔNG CỤ</em></span> Xác thực với một máy phục vụ Windows</strong></p></div></div></div> 
			 <p>
				Winbind cho các nhà quản trị hệ thống một lựa chọn sử dụng máy phục vụ Windows làm máy phục vụ việc xác thực. Winbind cũng tích hợp chặt với PAM và NSS. Điều này cho phép cài đặt các máy Linux mà tất cả những người sử dụng của một miền máy tính Windows tự động nhận được một tài khoản.
			</p>
			 <a id="id-1.14.8.9.6.3" class="indexterm"></a>
			 <p>
				Thông tin thêm có thể được tìm thấy ở thư mục <code class="filename">/usr/share/doc/samba-doc/examples/pam_winbind/</code>.
			</p>
			 </div> <section class="section" id="id-1.14.8.9.7"><div class="titlepage"><div><div><h4 class="title"><a xmlns="" id="id-1.14.8.9.7"/>11.5.1.1. Cấu hình với <span class="command"><strong>debconf</strong></span></h4></div></div></div>
				
				 <p>
					Gói phần mềm này cài đặt một cấu hình đơn giản trong suốt quá trình cài đặt ban đầu nhưng bạn nên thực sự chạy lệnh <span class="command"><strong>dpkg-reconfigure samba-common</strong></span> để nó thích ứng:
				</p>
				 <p>
					Mảnh thông tin bắt buộc đầu tiên là tên của nhóm làm việc(workgroup) mà máy phục vụ Samba thuộc về (câu trả lời là <code class="literal">FALCOTNET</code> trong trường hợp của chúng ta).
				</p>
				 <p>
					Gói phần mềm này cũng đề xuất nhận dạng máy phục vụ WINS từ thông tin được cung cấp bởi dịch vụ nền DHCP. Các nhà quản trị hệ thống của Công ty Falcot từ chối lựa chọn này, bởi họ muốn dùng chính máy phục vụ Samba làm máy phục vụ WINS.
				</p>
				 <a id="id-1.14.8.9.7.5" class="indexterm"></a>

			</section>
			 <section class="section" id="id-1.14.8.9.8"><div class="titlepage"><div><div><h4 class="title"><a xmlns="" id="id-1.14.8.9.8"/>11.5.1.2. Cấu hình thủ công</h4></div></div></div>
				
				 <section class="section" id="id-1.14.8.9.8.2"><div class="titlepage"><div><div><h5 class="title"><a xmlns="" id="id-1.14.8.9.8.2"/>11.5.1.2.1. Những thay đổi cho <code class="filename">smb.conf</code></h5></div></div></div>
					
					 <p>
						Những yêu cầu tại Falcot bắt buộc các lựa chọn khác phải được thay đổi trong tập tin cấu hình <code class="filename">/etc/samba/smb.conf</code>. Đoạn mã sau tóm tắt các thay đổi trong phần <code class="literal">[global]</code>.
					</p>
					 
<pre class="programlisting">
[global]

## Duyệt/Nhận dạng ###

# Thay đổi dòng sau thành nhóm-làm-việc/miền-máy-tính-NT mà máy phục vụ Samba sẽ là một phần trong đó
   workgroup = FALCOTNET

# Phần hỗ trợ Windows Internet Name Serving:
# WINS Support - Bảo thành phần NMBD của Samba để kích hoạt máy phục vụ WINS
   wins support = yes <span id="smb.conf.wins"/><a xmlns="" id="smb.conf.wins"/><span class="callout">1</span>

[...]

####### Xác thực #######

# Vai trò máy phục vụ. Xác định chế độ mà Samba sẽ hoạt động. Các giá trị có khả thi
# là "máy phục vụ đơn độc", "máy phục vụ thành viên", "trạm điều khiển miền máy tính chủ lực cổ điển 
# (classic primary domain controller)", "trạm điều khiển miền máy tính dự phòng cổ điển
# (classic backup domain controller)", "trạm điều khiển miền máy tính active directory 
# (active directory domain controller)".
#
# Đa số người dùng sẽ muốn "máy phục vụ đơn độc" hoặc "máy phục vụ thành viên".
# Chạy như "trạm điều khiển miền máy tính active directory" sẽ buộc trước tiên
# chạy "samba-tool domain provision" để xóa sạch các cơ sở dữ liệu và tạo một miền máy tính
# mới.
   server role = standalone server

# "security = user" luôn là một ý tốt. Điều này sẽ buộc phải có một tài khoản Unix
# trong máy phục vụ này cho mỗi người sử dụng truy cập máy phục vụ.
   security = user <span id="smb.conf.security"/><a xmlns="" id="smb.conf.security"/><span class="callout">2</span>

[...]</pre>
					 <div class="calloutlist"><dl class="calloutlist"><dt><a href="#smb.conf.wins"><span class="callout">1</span></a> </dt><dd>
							<p>
								Chỉ ra rằng Samba nên hoạt động như một máy phục vụ tên Netbios (Netbios name server) cho mạng nội bộ.
							</p>

						</dd><dt><a href="#smb.conf.security"><span class="callout">2</span></a> </dt><dd>
							<p>
								Đây là giá trị ngầm định cho tham biến này; tuy nhiên, bởi nó là cốt lõi trong cấu hình Samba, điền giá trị vào một cách công khai được khuyến cáo. Mỗi người sử dụng phải xác thực trước khi truy cập một chia sẻ nào.
							</p>

						</dd></dl></div>

				</section>
				 <section class="section" id="id-1.14.8.9.8.3"><div class="titlepage"><div><div><h5 class="title"><a xmlns="" id="id-1.14.8.9.8.3"/>11.5.1.2.2. Adding Users</h5></div></div></div>
					
					 <p>
						Each Samba user needs an account on the server; the Unix accounts must be created first, then the user needs to be registered in Samba's database. The Unix step is done quite normally (using <span class="command"><strong>adduser</strong></span> for instance).
					</p>
					 <p>
						Adding an existing user to the Samba database is a matter of running the <span class="command"><strong>smbpasswd -a <em class="replaceable">user</em></strong></span> command; this command asks for the password interactively.
					</p>
					 <p>
						A user can be deleted with the <span class="command"><strong>smbpasswd -x <em class="replaceable">user</em></strong></span> command. A Samba account can also be temporarily disabled (with <span class="command"><strong>smbpasswd -d <em class="replaceable">user</em></strong></span>) and re-enabled later (with <span class="command"><strong>smbpasswd -e <em class="replaceable">user</em></strong></span>).
					</p>

				</section>

			</section>

		</section>
		 <section class="section" id="id-1.14.8.10"><div class="titlepage"><div><div><h3 class="title"><a xmlns="" id="id-1.14.8.10"/>11.5.2. Samba Client</h3></div></div></div>
			
			 <p>
				The client features in Samba allow a Linux machine to access Windows shares and shared printers. The required programs are available in the <span class="pkg pkg">cifs-utils</span> and <span class="pkg pkg">smbclient</span> packages.
			</p>
			 <a id="id-1.14.8.10.3" class="indexterm"></a>
			 <a id="id-1.14.8.10.4" class="indexterm"></a>
			 <section class="section" id="id-1.14.8.10.5"><div class="titlepage"><div><div><h4 class="title"><a xmlns="" id="id-1.14.8.10.5"/>11.5.2.1. The <span class="command"><strong>smbclient</strong></span> Program</h4></div></div></div>
				
				 <p>
					The <span class="command"><strong>smbclient</strong></span> program queries SMB servers. It accepts a <code class="literal">-U <em class="replaceable">user</em></code> option, for connecting to the server under a specific identity. <span class="command"><strong>smbclient //<em class="replaceable">server</em>/<em class="replaceable">share</em></strong></span> accesses the share in an interactive way similar to the command-line FTP client. <span class="command"><strong>smbclient -L <em class="replaceable">server</em></strong></span> lists all available (and visible) shares on a server.
				</p>

			</section>
			 <section class="section" id="id-1.14.8.10.6"><div class="titlepage"><div><div><h4 class="title"><a xmlns="" id="id-1.14.8.10.6"/>11.5.2.2. Mounting Windows Shares</h4></div></div></div>
				
				 <p>
					The <span class="command"><strong>mount</strong></span> command allows mounting a Windows share into the Linux filesystem hierarchy (with the help of <span class="command"><strong>mount.cifs</strong></span> provided by <span class="pkg pkg">cifs-utils</span>).
				</p>
				 <a id="id-1.14.8.10.6.3" class="indexterm"></a>
				 <a id="id-1.14.8.10.6.4" class="indexterm"></a>
				 <div class="example" id="id-1.14.8.10.6.5"><a xmlns="" id="id-1.14.8.10.6.5"/><p class="title"><strong>Ví dụ 11.24. Mounting a Windows share</strong></p><div class="example-contents">
					
					 
<pre class="programlisting">
mount -t cifs //arrakis/shared /shared \
      -o credentials=/etc/smb-credentials
</pre>

				</div></div>
				 <p>
					The <code class="filename">/etc/smb-credentials</code> file (which must not be readable by users) has the following format:
				</p>
				 
<pre class="programlisting">
username = <em class="replaceable">user</em>
password = <em class="replaceable">password</em></pre>
				 <p>
					Other options can be specified on the command-line; their full list is available in the <span class="citerefentry"><span class="refentrytitle">mount.cifs</span>
					 (1)</span> manual page. Two options in particular can be interesting: <code class="literal">uid</code> and <code class="literal">gid</code> allow forcing the owner and group of files available on the mount, so as not to restrict access to root.
				</p>
				 <p>
					A mount of a Windows share can also be configured in <code class="filename">/etc/fstab</code>:
				</p>
				 
<pre class="programlisting">
//<em class="replaceable">server</em>/shared /shared cifs credentials=/etc/smb-credentials
</pre>
				 <p>
					Unmounting a SMB/CIFS share is done with the standard <span class="command"><strong>umount</strong></span> command.
				</p>

			</section>
			 <section class="section" id="id-1.14.8.10.7"><div class="titlepage"><div><div><h4 class="title"><a xmlns="" id="id-1.14.8.10.7"/>11.5.2.3. Printing on a Shared Printer</h4></div></div></div>
				
				 <p>
					CUPS is an elegant solution for printing from a Linux workstation to a printer shared by a Windows machine. When the <span class="pkg pkg">smbclient</span> is installed, CUPS allows installing Windows shared printers automatically.
				</p>
				 <a id="id-1.14.8.10.7.3" class="indexterm"></a>
				 <p>
					Here are the required steps:
				</p>
				 <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<p>
							Enter the CUPS configuration interface: <code class="literal">http://localhost:631/admin</code>
						</p>

					</li><li class="listitem">
						<p>
							Click on “Add Printer”.
						</p>

					</li><li class="listitem">
						<p>
							Choose the printer device, pick “Windows Printer via SAMBA”.
						</p>

					</li><li class="listitem">
						<p>
							Enter the connection URI for the network printer. It should look like the following:
						</p>
						 <p>
							<code class="literal">smb://<em class="replaceable">user</em>:<em class="replaceable">password</em>@<em class="replaceable">server</em>/<em class="replaceable">printer</em></code>.
						</p>

					</li><li class="listitem">
						<p>
							Enter the name that will uniquely identify this printer. Then enter the description and location of the printer. Those are the strings that will be shown to end users to help them identify the printers.
						</p>

					</li><li class="listitem">
						<p>
							Indicate the manufacturer/model of the printer, or directly provide a working printer description file (PPD).
						</p>

					</li></ul></div>
				 <p>
					Voilà, the printer is operational!
				</p>

			</section>

		</section>

	</section><footer/></body></html>