<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>11.4. Máy phục vụ tập tin NFS</title><meta name="generator" content="publican v4.3.2"/><meta name="keywords" content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP"/><link rel="prev" href="sect.ftp-file-server.html" title="11.3. Máy phục vụ Tập tin FTP"/><link rel="next" href="sect.windows-file-server-with-samba.html" title="11.5. Setting Up Windows Shares with Samba"/><link xmlns="" rel="canonical" href="https://debian-handbook.info/browse/vi-VN/stable/sect.nfs-file-server.html"/></head><body onLoad="initSwitchery(); jQuery(&quot;#poptoc&quot;).load('index.html .toc:eq(0)'); jQuery('.programlisting').each(function(i, block){hljs.highlightBlock(block);});" onClick="hide('poptoc');"><header><div id="banner"><a href="http://debian-handbook.info/get/"><span class="text">Download the ebook</span></a></div><ul class="docnav top"><li class="previous"><a accesskey="p" href="sect.ftp-file-server.html"><strong>Trước đó</strong></a></li><li class="home" onClick="work=1;showhide('poptoc');">Sổ tay Quản trị Debian</li><li class="next"><a accesskey="n" href="sect.windows-file-server-with-samba.html"><strong>Kế tiếp</strong></a></li></ul></header><div id="poptoc" class="hidden"> </div><section class="section" id="sect.nfs-file-server"><div class="titlepage"><div><div><h2 class="title"><a xmlns="" id="sect.nfs-file-server"/>11.4. Máy phục vụ tập tin NFS</h2></div></div></div>
		
		 <p>
			NFS ("<span class="emphasis"><em>Hệ thống Tập tin Mạng(Network File System)</em></span>) là một giao thức cho phép truy cập từ xa tới một hệ thống tập tin thông qua mạng. Tất cả các hệ thống Unix có thể làm việc với giao thức này; khi các hệ thống Windows có liên quan, Samba phải được sử dụng thay thế.
		</p>
		 <a id="id-1.14.7.3" class="indexterm"></a>
		 <a id="id-1.14.7.4" class="indexterm"></a>
		 <a id="id-1.14.7.5" class="indexterm"></a>
		 <a id="id-1.14.7.6" class="indexterm"></a>
		 <a id="id-1.14.7.7" class="indexterm"></a>
		 <p>
			NFS là một công cụ hữu dụng nhưng, theo lịch sử, nó đã hứng chịu nhiều giới hạn, đa số được giải quyết với phiên bản số 4 của giao thức này. Ngược lại, phiên bản mới nhất của NFS khó cấu hình hơn khi bạn muốn sử dụng các tính năng an ninh đơn giản ví dụ như xác thực và mã hóa bởi nó dựa trên Kerberos cho những thành phần đó. Và nếu không có những thứ trên, giao thức NFS phải được giới hạn lại trong một mạng lưới nội bộ đáng tin cậy bởi dữ liệu di chuyển trên mạng nội bộ mà không được mã hóa (một <span class="emphasis"><em>kẻ nghe lén(sniffer)</em></span> có thể can thiệp nó) và quyền truy cập được cung cấp dựa trên địa chỉ IP của khách (vốn có thể được làm giả).
		</p>
		 <div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong><span class="emphasis"><em>TÀI LIỆU HƯỚNG DẪN</em></span> HƯỚNG DẪN NFS</strong></p></div></div></div> 
		 <p>
			Tài liệu hướng dẫn có chất lượng để chạy NFSv4 thì khá khan hiếm. Đây là một vài nguồn với những nội dung có mức độ chi tiết khác nhau nhưng đó ít nhất sẽ cho bạn một số thông tin về những gì cần phải làm. <a class="ulink" href="https://help.ubuntu.com/community/NFSv4Howto">https://help.ubuntu.com/community/NFSv4Howto</a> <a class="ulink" href="http://wiki.linux-nfs.org/wiki/index.php/Nfsv4_configuration">http://wiki.linux-nfs.org/wiki/index.php/Nfsv4_configuration</a>
		</p>
		 </div> <section class="section" id="id-1.14.7.10"><div class="titlepage"><div><div><h3 class="title"><a xmlns="" id="id-1.14.7.10"/>11.4.1. Đảm bảo an ninh cho NFS</h3></div></div></div>
			
			 <a id="id-1.14.7.10.2" class="indexterm"></a>
			 <p>
				Nếu bạn không sử dụng các tính năng an ninh dựa trên Kerberos, sẽ rất quan trọng để đảm bảo rằng chỉ những máy được cho phép sử dụng NFS mới có thể kết nối tới các máy phục vụ RPC cần thiết, bởi giao thức NFS về cơ bản luôn tin tưởng dữ liệu nhận được từ mạng. Tường lửa cũng chặn <span class="emphasis"><em>việc làm giả IP</em></span> để phòng ngừa việc một máy bên ngoài hành động như một máy bên trong, và truy cập tới các cổng tương ứng phải được giới hạn lại những máy chỉ dùng để truy cập các chia sẻ NFS.
			</p>
			 <div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong><span class="emphasis"><em>TRỞ VỀ CƠ BẢN</em></span> RPC</strong></p></div></div></div> 
			 <p>
				RPC (<span class="emphasis"><em>Remote Procedure Call(Thực thi Hàm Từ xa)</em></span>) là một chuẩn Unix cho các dịch vụ chạy từ xa. NFS là một dịch vụ như vậy.
			</p>
			 <a id="id-1.14.7.10.4.3" class="indexterm"></a>
			 <a id="id-1.14.7.10.4.4" class="indexterm"></a>
			 <p>
				Các dịch vụ RPC đăng ký với một danh bạ được biết đến như là <span class="emphasis"><em>danh bạ cổng (portmapper)</em></span>. Một máy khách có ý muốn thực hiện một yêu cầu liên quan tới NFS trước tiên tìm đến <span class="emphasis"><em>danh bạ cổng (portmapper)</em></span> (ở cổng 111, hoặc TCP hoặc UDP), và hỏi tìm máy phục vụ NFS; câu trả lời thường đề cập cổng 2049 (ngầm định cho NFS). Không phải tất cả các dịch vụ RPC cần sử dụng một cổng cố định.
			</p>
			 </div> <p>
				Các phiên phản cũ hơn của giao thức buộc sự hiện diện của các dịch vụ RPC khác vốn dùng các cổng được gán linh động. May mắn thay, với phiên bản NFS 4, chỉ cổng 2049 (cho NFS) và 111 (cho danh bạ cổng) là cần thiết và tường lửa dễ dàng được cài đặt hơn.
			</p>
			 <a id="id-1.14.7.10.6" class="indexterm"></a>

		</section>
		 <section class="section" id="id-1.14.7.11"><div class="titlepage"><div><div><h3 class="title"><a xmlns="" id="id-1.14.7.11"/>11.4.2. Máy phục vụ NFS</h3></div></div></div>
			
			 <p>
				Máy phục vụ NFS là một phần của nhân(kernel) Linux; trong những nhân(kernel) được cung cấp bởi Debian nó được xây dựng như một mô-đun của nhân. Nếu máy phục vụ NFS được chạy tự động khi khởi động máy, gói phần mềm <span class="pkg pkg">nfs-kernel-server</span> nên được cài đặt; nó chứa các đoạn mã kịch bản khởi động có liên quan.
			</p>
			 <p>
				Tập tin cấu hình máy phục vụ NFS, <code class="filename">/etc/exports</code>, liệt kê những thư mục được tạo sẵn trên mạng (<span class="emphasis"><em>được xuất khẩu (exported)</em></span>). Với mỗi chia sẻ NFS, chỉ có một danh sách các máy cho trước là được cung cấp truy cập. Kiểm soát truy cập chi tiết hơn có thể được đạt được với một vài lựa chọn. Cú pháp của tập tin này thì khá đơn giản:
			</p>
			 <a id="id-1.14.7.11.4" class="indexterm"></a>
			 <a id="id-1.14.7.11.5" class="indexterm"></a>
			 
<pre class="programlisting">
/đường_dẫn/tới/thư_mục_được_chia_sẻ máy-số_1(lựa_chọn_1,lựa_chọn_2,...) máy_số_2(...) ...</pre>
			 <p>
				Ghi chú rằng với NFSv4, tất cả các thư mục được xuất khẩu phải là một phần của một cây duy nhất và thư mục gốc của cây đó phải được xuất ra và nhận dạng với lựa chọn <code class="literal">fsid=0</code> hoặc <code class="literal">fsid=root</code>.
			</p>
			 <p>
				Mỗi máy có thể được nhận dạng bởi tên miền DNS của nó hoặc địa chỉ IP của nó. Các tập hợp đầy đủ các máy tính cũng có thể được chỉ định bằng cú pháp như <code class="literal">*.falcot.com</code> hoặc một vùng các địa chỉ IP như <code class="literal">192.168.0.0/255.255.255.0</code> hoặc <code class="literal">192.168.0.0/24</code>.
			</p>
			 <p>
				Các thư mục được tạo sẵn chỉ để đọc theo ngầm định (hoặc với lựa chọn <code class="literal">ro</code>). Lựa chọn <code class="literal">rw</code> cho phép truy cập đọc-viết. Những chương trình khách NFS thường kết nối từ một cổng giới hạn dành cho quản trị viên (root) (nói cách khác, dưới 1024); giới hạn này có thể được xóa bỏ bởi lựa chọn <code class="literal">insecure</code> (lựa chọn <code class="literal">insecure</code> luôn được ám chỉ, nhưng có thể được công khai nếu cần phải làm rõ)
			</p>
			 <a id="id-1.14.7.11.10" class="indexterm"></a>
			 <p>
				Theo ngầm định, máy phục vụ chỉ trả lời một yêu cầu NFS khi một tác vụ hiện thời trên đĩa là hoàn tất (lựa chọn <code class="literal">sync</code>); điều này có thể được tắt bằng lựa chọn <code class="literal">async</code>. Các lần ghi không đồng bộ giúp tăng hiệu suất một chút, nhưng chúng giảm độ tin cậy bởi có nguy cơ mất dữ liệu trong trường hợp máy phục vụ gặp sự cố giữa lúc xác nhận việc ghi dữ liệu và hành động ghi dữ liệu thật sự lên đĩa cứng. Bởi giá trị ngầm định thay đổi trong thời gian gần đây (so với giá trị trước đây của NFS), một cài đặt công khai rõ ràng luôn được khuyến khích.
			</p>
			 <p>
				Để tránh cho phép bất cứ chương trình khách NFS nào truy cập dưới quyền quản trị viên vào hệ thống tập tin, tất cả các truy cập trông như đến từ một tài khoản quyền quản trị viên được xem bởi máy phục vụ như là đến từ một tài khoản <code class="literal">nobody</code>. Hành vi này tương ứng với lựa chọn <code class="literal">root_squash</code>, và được kích hoạt theo ngầm định. Lựa chọn <code class="literal">no_root_squash</code>, vốn tắt hành vi này, là mạo hiểm và chỉ nên được sử dụng trong môi trường được kiểm soát. Lựa chọn <code class="literal">anonuid=<em class="replaceable">uid</em></code> và <code class="literal">anongid=<em class="replaceable">gid</em></code> cho phép việc chỉ định một tài khoản người dùng giả khác để được sử dụng thay cho UID/GID 65534 (vốn tương ứng với tài khoản <code class="literal">nobody</code> và nhóm <code class="literal">nogroup</code>).
			</p>
			 <p>
				Với NFSv4, bạn có thể thêm lựa chọn <code class="literal">sec</code> để chỉ định mức an ninh mà bạn muốn: <code class="literal">sec=sys</code> là mức ngầm định mà không có tính năng an ninh đặc biệt nào cả, <code class="literal">sec=krb5</code> chỉ kích hoạt xác thực, <code class="literal">sec=krb5i</code> thêm sự bảo vệ tính chặt chẽ, và <code class="literal">sec=krb5p</code> là mức hoàn thiện nhất vốn kèm cả sự bảo vệ tính riêng tư (với mã hóa dữ liệu). Để điều này hoạt động tốt bạn cần có một bản cài đặt Kerberos chạy tốt(dịch vụ đó không được giải thích bởi cuốn sách này).
			</p>
			 <p>
				Các lựa chọn khác cũng có sẵn; chúng được ghi lại trong trang <span class="citerefentry"><span class="refentrytitle">exports</span>
				 (5)</span> của tài liệu hướng dẫn.
			</p>
			 <div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong><span class="emphasis"><em>CẢNH BÁO</em></span> Lần cài đặt đầu tiên</strong></p></div></div></div> 
			 <p>
				Kịch bản khởi động <code class="filename">/etc/init.d/nfs-kernel-server</code> chỉ khởi động máy phục vụ nếu <code class="filename">/etc/exports</code> liệt kê một hoặc nhiều chia sẻ NFS hợp lệ. Với cấu hình ban đầu, một khi tập tin này được chỉnh sửa để chứa các chỉ mục hợp lệ, khi đó máy phục vụ NFS phải được khởi động với lệnh sau:
			</p>
			 
<pre class="screen">
<code class="computeroutput"># </code><strong class="userinput"><code>service nfs-kernel-server start</code></strong></pre>
			 </div>
		</section>
		 <section class="section" id="id-1.14.7.12"><div class="titlepage"><div><div><h3 class="title"><a xmlns="" id="id-1.14.7.12"/>11.4.3. Chương trình khách NFS</h3></div></div></div>
			
			 <a id="id-1.14.7.12.2" class="indexterm"></a>
			 <a id="id-1.14.7.12.3" class="indexterm"></a>
			 <p>
				Giống như các hệ thống tập tin khác, việc tích hợp một chuẩn NFS vào cây hệ thống đòi hỏi phải có kết nối. Bởi hệ thống tập tin này khá khác biệt, một vài tùy chỉnh là cần thiết đối với cú pháp của lệnh <span class="command"><strong>mount</strong></span> và tập tin <code class="filename">/etc/fstab</code>.
			</p>
			 <div class="example" id="id-1.14.7.12.5"><a xmlns="" id="id-1.14.7.12.5"/><p class="title"><strong>Ví dụ 11.22. Kết nối thủ công với lệnh <span class="command">mount</span></strong></p><div class="example-contents">
				
				 
<pre class="screen">
          <code class="computeroutput"># </code><strong class="userinput"><code>mount -t nfs4 -o rw,nosuid arrakis.internal.falcot.com:/shared /srv/shared</code></strong></pre>

			</div></div>
			 <div class="example" id="id-1.14.7.12.6"><a xmlns="" id="id-1.14.7.12.6"/><p class="title"><strong>Ví dụ 11.23. Mục NFS trong tập tin <code class="filename">/etc/fstab</code></strong></p><div class="example-contents">
				
				 
<pre class="programlisting">
arrakis.internal.falcot.com:/shared /srv/shared nfs4 rw,nosuid 0 0</pre>

			</div></div>
			 <p>
				Mục được mô tả phía trên kết nối, khi hệ thống khởi động, thư mục NFS <code class="filename">/shared/</code> từ máy phục vụ <code class="literal">arrakis</code> vào thư mục nội bộ <code class="filename">/srv/shared/</code>. Truy cập đọc-ghi được yêu cầu (và vì thế có tham số <code class="literal">rw</code>). Lựa chọn <code class="literal">nosuid</code> là một biện pháp bảo vệ vốn dọn sạch các bit <code class="literal">setuid</code> or <code class="literal">setgid</code> khỏi những chương trình được lưu trong chia sẻ. Nếu chia sẻ NFS chỉ dành cho lưu trữ các tài liệu, một lựa chọn được đề xuất khác là <code class="literal">noexec</code>, vốn chặn các chương trình đang chạy lưu lên chia sẻ. Ghi chú rằng trên máy phục vụ, thư mục <code class="filename">shared</code> nằm dưới mục xuất khẩu gốc NFSv4 (ví dụ <code class="filename">/export/shared</code>), nó không phải là một thư mục gốc.
			</p>
			 <p>
				Trang hướng dẫn sử dụng <span class="citerefentry"><span class="refentrytitle">nfs</span>
				 (5)</span> mô tả các lựa chọn chi tiết hơn.
			</p>

		</section>

	</section><footer/></body></html>