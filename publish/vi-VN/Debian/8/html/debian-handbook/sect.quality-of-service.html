<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>10.3. Quality of Service</title><meta name="generator" content="publican v4.3.2"/><meta name="keywords" content="Network, Gateway, TCP/IP, IPv6, DNS, Bind, DHCP, QoS"/><link rel="prev" href="sect.virtual-private-network.html" title="10.2. Virtual Private Network"/><link rel="next" href="sect.dynamic-routing.html" title="10.4. Dynamic Routing"/><link xmlns="" rel="canonical" href="https://debian-handbook.info/browse/vi-VN/stable/sect.quality-of-service.html"/></head><body onLoad="initSwitchery(); jQuery(&quot;#poptoc&quot;).load('index.html .toc:eq(0)'); jQuery('.programlisting').each(function(i, block){hljs.highlightBlock(block);});" onClick="hide('poptoc');"><header><div id="banner"><a href="http://debian-handbook.info/get/"><span class="text">Download the ebook</span></a></div><ul class="docnav top"><li class="previous"><a accesskey="p" href="sect.virtual-private-network.html"><strong>Trước đó</strong></a></li><li class="home" onClick="work=1;showhide('poptoc');">Sổ tay Quản trị Debian</li><li class="next"><a accesskey="n" href="sect.dynamic-routing.html"><strong>Kế tiếp</strong></a></li></ul></header><div id="poptoc" class="hidden"> </div><section class="section" id="sect.quality-of-service"><div class="titlepage"><div><div><h2 class="title"><a xmlns="" id="sect.quality-of-service"/>10.3. Quality of Service</h2></div></div></div>
		
		 <section class="section" id="sect.qos-principe"><div class="titlepage"><div><div><h3 class="title"><a xmlns="" id="sect.qos-principe"/>10.3.1. Principle and Mechanism</h3></div></div></div>
			
			 <p>
				<span class="emphasis"><em>Quality of Service</em></span> (or <span class="emphasis"><em>QoS</em></span> for short) refers to a set of techniques that guarantee or improve the quality of the service provided to applications. The most popular such technique involves classifying the network traffic into categories, and differentiating the handling of traffic according to which category it belongs to. The main application of this differentiated services concept is <span class="emphasis"><em>traffic shaping</em></span>, which limits the data transmission rates for connections related to some services and/or hosts so as not to saturate the available bandwidth and starve important other services. Traffic shaping is a particularly good fit for TCP traffic, since this protocol automatically adapts to available bandwidth.
			</p>
			 <a id="id-1.13.6.2.3" class="indexterm"></a>
			 <a id="id-1.13.6.2.4" class="indexterm"></a>
			 <a id="id-1.13.6.2.5" class="indexterm"></a>
			 <a id="id-1.13.6.2.6" class="indexterm"></a>
			 <p>
				It is also possible to alter the priorities on traffic, which allows prioritizing packets related to interactive services (such as <span class="command"><strong>ssh</strong></span> and <span class="command"><strong>telnet</strong></span>) or to services that only deal with small blocks of data.
			</p>
			 <p>
				The Debian kernels include the features required for QoS along with their associated modules. These modules are many, and each of them provides a different service, most notably by way of special schedulers for the queues of IP packets; the wide range of available scheduler behaviors spans the whole range of possible requirements.
			</p>
			 <div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong><span class="emphasis"><em>CULTURE</em></span> LARTC — <span class="emphasis"><em>Linux Advanced Routing &amp; Traffic Control</em></span></strong></p></div></div></div> 
			 <p>
				The <span class="emphasis"><em>Linux Advanced Routing &amp; Traffic Control</em></span> HOWTO is the reference document covering everything there is to know about network quality of service. <a class="ulink" href="http://www.lartc.org/howto/">http://www.lartc.org/howto/</a>
			</p>
			 <a id="id-1.13.6.2.9.3" class="indexterm"></a>
			 <a id="id-1.13.6.2.9.4" class="indexterm"></a>
			 <a id="id-1.13.6.2.9.5" class="indexterm"></a>
			 </div>
		</section>
		 <section class="section" id="sect.qos-config"><div class="titlepage"><div><div><h3 class="title"><a xmlns="" id="sect.qos-config"/>10.3.2. Configuring and Implementing</h3></div></div></div>
			
			 <p>
				QoS parameters are set through the <span class="command"><strong>tc</strong></span> command (provided by the <span class="pkg pkg">iproute</span> package). Since its interface is quite complex, using higher-level tools is recommended.
			</p>
			 <a id="id-1.13.6.3.3" class="indexterm"></a>
			 <a id="id-1.13.6.3.4" class="indexterm"></a>
			 <section class="section" id="sect.qos-wondershaper"><div class="titlepage"><div><div><h4 class="title"><a xmlns="" id="sect.qos-wondershaper"/>10.3.2.1. Reducing Latencies: <span class="command"><strong>wondershaper</strong></span></h4></div></div></div>
				
				 <p>
					The main purpose of <span class="command"><strong>wondershaper</strong></span> (in the similarly-named package) is to minimize latencies independent of network load. This is achieved by limiting total traffic to a value that falls just short of the link saturation value.
				</p>
				 <a id="id-1.13.6.3.5.3" class="indexterm"></a>
				 <a id="id-1.13.6.3.5.4" class="indexterm"></a>
				 <a id="id-1.13.6.3.5.5" class="indexterm"></a>
				 <p>
					Once a network interface is configured, setting up this traffic limitation is achieved by running <span class="command"><strong>wondershaper <em class="replaceable">interface</em> <em class="replaceable">download_rate</em> <em class="replaceable">upload_rate</em></strong></span>. The interface can be <code class="literal">eth0</code> or <code class="literal">ppp0</code> for example, and both rates are expressed in kilobits per second. The <span class="command"><strong>wondershaper remove <em class="replaceable">interface</em></strong></span> command disables traffic control on the specified interface.
				</p>
				 <p>
					For an Ethernet connection, this script is best called right after the interface is configured. This is done by adding <code class="literal">up</code> and <code class="literal">down</code> directives to the <code class="filename">/etc/network/interfaces</code> file allowing declared commands to be run, respectively, after the interface is configured and before it is deconfigured. For example:
				</p>
				 <div class="example" id="example.network-interfaces"><a xmlns="" id="example.network-interfaces"/><p class="title"><strong>Ví dụ 10.9. Changes in the <code class="filename">/etc/network/interfaces</code> file</strong></p><div class="example-contents">
					
					 
<pre class="programlisting">
iface eth0 inet dhcp
    up /sbin/wondershaper eth0 500 100
    down /sbin/wondershaper remove eth0
</pre>

				</div></div>
				 <p>
					In the PPP case, creating a script that calls <span class="command"><strong>wondershaper</strong></span> in <code class="filename">/etc/ppp/ip-up.d/</code> will enable traffic control as soon as the connection is up.
				</p>
				 <div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong><span class="emphasis"><em>GOING FURTHER</em></span> Optimal configuration</strong></p></div></div></div> 
				 <p>
					The <code class="filename">/usr/share/doc/wondershaper/README.Debian.gz</code> file describes, in some detail, the configuration method recommended by the package maintainer. In particular, it advises measuring the download and upload speeds so as to best evaluate real limits.
				</p>
				 </div>
			</section>
			 <section class="section" id="sect.qos-config-standard"><div class="titlepage"><div><div><h4 class="title"><a xmlns="" id="sect.qos-config-standard"/>10.3.2.2. Standard Configuration</h4></div></div></div>
				
				 <p>
					Barring a specific QoS configuration, the Linux kernel uses the <code class="literal">pfifo_fast</code> queue scheduler, which provides a few interesting features by itself. The priority of each processed IP packet is based on the ToS field (<span class="emphasis"><em>Type of Service</em></span>) of this packet; modifying this field is enough to take advantage of the scheduling features. There are five possible values:
				</p>
				 <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<p>
							Normal-Service (0);
						</p>

					</li><li class="listitem">
						<p>
							Minimize-Cost (2);
						</p>

					</li><li class="listitem">
						<p>
							Maximize-Reliability (4);
						</p>

					</li><li class="listitem">
						<p>
							Maximize-Throughput (8);
						</p>

					</li><li class="listitem">
						<p>
							Minimize-Delay (16).
						</p>

					</li></ul></div>
				 <a id="id-1.13.6.3.6.4" class="indexterm"></a>
				 <a id="id-1.13.6.3.6.5" class="indexterm"></a>
				 <p>
					The ToS field can be set by applications that generate IP packets, or modified on the fly by <span class="emphasis"><em>netfilter</em></span>. The following rules are sufficient to increase responsiveness for a server's SSH service:
				</p>
				 
<pre class="programlisting scale scale">
iptables -t mangle -A PREROUTING -p tcp --sport ssh -j TOS --set-tos Minimize-Delay
iptables -t mangle -A PREROUTING -p tcp --dport ssh -j TOS --set-tos Minimize-Delay
</pre>

			</section>

		</section>

	</section><footer/></body></html>